// openassessment: views - base
// ====================

// NOTES:
// * The basic view and all of its states of the openassessment xblock

.wrapper--openassessment {
  position: relative;
}

.openassessment {

  // --------------------
  // general
  // --------------------

  // chrome: title
  .openassessment__title {
    @include row();
    margin-bottom: $baseline-v;
    border-bottom: ($baseline-v/5) solid $color-decorative-tertiary;
    padding-bottom: ($baseline-v/2);
  }

  .openassessment__title--super {
    @extend %hd-3;
    display: block;
    margin-bottom: ($baseline-v/4);
  }

  .openassessment__title--sub {
    @extend %hd-7;
    display: block;
    color: $heading-tertiary-color;
  }

  // steps
  .openassessment__steps {
    @extend %no-list;
    counter-reset: item; // setting counter here
  }

  .openassessment__steps__step {
    margin-bottom: $baseline-v;
    border-bottom: ($baseline-v/10) solid $color-decorative-tertiary;
    padding-bottom: $baseline-v;

    &:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    // step header
    .step__header {
      @extend %trans-opacity;
      @include row();
      opacity: 1.0;

      .step__deadline {
        color: $color-focused;
      }
    }

    // step title/name
    .step__title {

      @include media($bp-ds) {
        @include span-columns(4 of 6);
      }

      @include media($bp-dm) {
        @include span-columns(9 of 12);
      }

      @include media($bp-dl) {
        @include span-columns(9 of 12);
      }

      @include media($bp-dx) {
        @include span-columns(9 of 12);
      }

      .step__counter, .wrapper--copy {
        display: inline-block;
        vertical-align: middle;
      }

      // step counter
      .step__counter {

        // increment: show numbers using parent list counter
        &:before {
          @extend %hd-6;
          @extend %t-weight4;
          content: counter(item, decimal);
          counter-increment: item;
          margin-right: ($baseline-v/4);
          border-radius: ($baseline-v/10);
          border: 1px solid rgba($color-focused, 0.5);
          padding: ($baseline-v/4) ($baseline-v/2);
          color: $color-focused;

        }
      }

      .step__label, .step__deadline {
        display: block;
      }

      .step__label {
        @extend %hd-4;
        @extend %t-weight3;
        @extend %trans-color;
      }

      .step__deadline {
        @extend %hd-8;
        @extend %trans-color;
        color: $heading-secondary-color;
      }
    }


    // step status
    .step__status {

      .step__status__value {
        display: block;
        border-radius: ($baseline-v/5);
        padding: ($baseline-v/4) ($baseline-h/4);
        background: $color-focused;
        color: $white-t;

        @include media($bp-m) {
          margin-top: ($baseline-v/2);
        }
      }

      .ico, .copy {
        display: inline-block;
        vertical-align: bottom;
      }

      .ico {
        @extend %t-icon-m;
        display: none; // hiding by default
        margin-right: ($baseline-v/4);
      }

      .copy {
        @extend %copy-6;
        @extend %t-titlecase;
        color: $white-t;
      }

      @include media($bp-m) {
        position: relative;
        top: 2px;
      }

      @include media($bp-ds) {
        @include span-columns(2 of 6);
        @include omega();
        margin-top: ($baseline-v/4);
        text-align: right;
      }

      @include media($bp-dm) {
        @include span-columns(3 of 12);
        @include omega();
        margin-top: ($baseline-v/4);
        text-align: right;
      }

      @include media($bp-dl) {
        @include span-columns(3 of 12);
        @include omega();
        margin-top: ($baseline-v/4);
        text-align: right;
      }

      @include media($bp-dx) {
        @include span-columns(3 of 12);
        @include omega();
        margin-top: ($baseline-v/4);
        text-align: right;
      }
    }

    .step__status__label {
    @extend %text-sr;
    }

    // step content wrapper
    .wrapper--step__content {
      margin-top: $baseline-v;
    }

    // step instructions
    .step__instruction {
      @extend %copy-4;
      margin-bottom: $baseline-v;
      color: $copy-color;
    }

    // step content
    .step__content {
      margin-bottom: $baseline-v;
    }

    // step actions
    .step__actions {
      @include transition(background-color $tmg-f1 ease-in-out 0s);
      border-radius: ($baseline-v/5);
      padding: ($baseline-v/2) ($baseline-h/2);
      background: transparent;
      text-align: center;

      @include media($bp-ds) {
        text-align: right;
      }

      @include media($bp-dm) {
       text-align: right;
      }

      @include media($bp-dl) {
        text-align: right;
      }

      @include media($bp-dx) {
        text-align: right;
      }

      .action--submit {
        @extend %btn--primary;
        @extend %action-4;
      }

      // STATE: has error
      &.has--error {
        @include row();
        background: tint($color-error, 90%);

        .message {
          display: block;
          margin-bottom: ($baseline-v/2);

          @include media($bp-ds) {
            @include span-columns(3 of 6);
            margin-bottom: 0;
            text-align: left;
          }

          @include media($bp-dm) {
            @include span-columns(6 of 12);
            margin-bottom: 0;
            text-align: left;
          }

          @include media($bp-dl) {
            @include span-columns(6 of 12);
            margin-bottom: 0;
            text-align: left;
          }

          @include media($bp-dx) {
            @include span-columns(6 of 12);
            margin-bottom: 0;
            text-align: left;
          }
        }

        .list--actions {
          display: block;

          @include media($bp-ds) {
            @include span-columns(3 of 6);
          }

          @include media($bp-dm) {
            @include span-columns(6 of 12);
          }

          @include media($bp-dl) {
            @include span-columns(6 of 12);
          }

          @include media($bp-dx) {
            @include span-columns(6 of 12);
          }
        }
      }
    }

    // STATE: step is loading
    &.is--loading {
      opacity: 0.3;

      .step__header {

        @include media($bp-ds) {
          border-bottom: none;
          padding-bottom: 0;
        }

        @include media($bp-dm) {
         border-bottom: none;
         padding-bottom: 0;
        }

        @include media($bp-dl) {
          border-bottom: none;
          padding-bottom: 0;
        }

        @include media($bp-dx) {
          border-bottom: none;
          padding-bottom: 0;
        }
      }
    }

    // STATE: step is collapsed (not focused on)
    &.is--collapsed {

      .step__header {
        opacity: 0.4;
        margin-bottom: 0;

        @include media($bp-ds) {
          border-bottom: none;
          padding-bottom: 0;
        }

        @include media($bp-dm) {
         border-bottom: none;
         padding-bottom: 0;
        }

        @include media($bp-dl) {
          border-bottom: none;
          padding-bottom: 0;
        }

        @include media($bp-dx) {
          border-bottom: none;
          padding-bottom: 0;
        }

        .step__deadline {
          color: $color-focused;
        }

        // STATE: hover
        &:hover, &:focus {
          opacity: 1.0;
        }
      }

      .step__status__value {
        background: $color-secondary;
      }

      // step counter
      .step__counter:before {
        border: 1px solid rgba($heading-color, 0.5);
      }
    }

    // STATE: step is incomplete
    &.is--incomplete {

    }

    // STATE: step is unavailable
    &.is--unavailable {

      .step__header:hover, .step__header:focus {
        opacity: 0.4;
      }
    }


    // STATE: step is complete/submitted/graded
    &.is--complete, &.is--submitted, &.is--graded {

      .step__counter:before {
        border-color: rgba($color-complete, 0.5);
        color: $color-complete;
      }

      .step__status__value {
        background: $color-complete;

        .ico {
          display: inline-block;
        }

        .copy {
          color: $white-t;
        }
      }
    }

    // STATE: has error
    &.has--error {

      .step__counter:before {
        border-color: rgba($color-error, 0.5);
        color: $color-error;
      }

      .step__status__value {
        background: $color-error;

        .copy {
          color: $white-t;
        }
      }

      .step__label {
        color: $color-error;
      }

      .message {

      }
    }
  }


  // --------------------
  // messages
  // --------------------
  .message {

    .message__title {
      @extend %hd-6;
    }

    .message__content {
      @extend %copy-4;
    }
  }

  // TYPE: error
  .message--error {


    .message__title {
      color: $color-error;
    }

    .message__content {
      color: tint($color-error, 33%);
    }
  }

  // TYPE: warning
  .message--warning {

  }

  // TYPE: confirmation
  .message--confirmation {

  }

  // --------------------
  // errors
  // --------------------
  // CASE: default error display (hidden)
  .message--error {
    @extend %trans-opacity;
    display: none;
    opacity: 0.0;
  }

  // CASE: error is shown
  .has--error {

    .message--error {
      display: block;
      opacity: 1.0;
    }
  }


  // --------------------
  // problem
  // --------------------
  .wrapper--openassessment__prompt {

  }

  .openassessment__prompt {
    margin-bottom: $baseline-v;
  }

  .openassessment__prompt__title {
    @extend %text-sr;
  }

  .openassessment__prompt__copy {
    @extend %copy-2;
    color: $copy-lead-color;

    > * {
      margin-bottom: $baseline-v;

      &:last-child {
        @extend %wipe-last-child;
      }
    }


    a {
      @extend %link-copy;
    }
  }


  // --------------------
  // response
  // --------------------
  .step--response {

    // response form
    .response__submission {
      margin-top: ($baseline-v*2.5);
      position: relative;
      padding: ($baseline-v*0.75);
      background: $color-decorative-tertiary;
      border-radius: ($baseline-v/10);
    }

    .response__submission__content {
      margin-bottom: ($baseline-v/2);

      label {
        @extend %text-sr;
      }

      textarea {
        @extend %ui-content-longanswer;
        min-height: ($baseline-v*10);
        margin-bottom: ($baseline-v/2);
      }
    }

    .response__submission__status {
      position: absolute;
      top: -($baseline-v*1.5);
      right: 0;
      background: $color-decorative-tertiary;
      padding: ($baseline-v/2) ($baseline-h/2);
      margin-bottom: ($baseline-v/2);
    }

    .response__submission__status__title {
      @extend %hd-7;
      @extend %t-weight3;
      color: $copy-supplemental-color;
    }

    .response__submission__actions {
      @include transition(background-color $tmg-f1 ease-in-out 0s);
      border-radius: ($baseline-v/5);
      padding: ($baseline-v/2) ($baseline-h/2);
      background: transparent;

      .action--save {
        @extend %btn--secondary;
        @extend %action-4;
        display: block;
        text-align: center;

        @include media($bp-ds) {
          display: inline-block;
          margin-right: ($baseline-v/2);
        }

        @include media($bp-dm) {
          display: inline-block;
          margin-right: ($baseline-v/2);
        }

        @include media($bp-dl) {
          display: inline-block;
          margin-right: ($baseline-v/2);
        }

        @include media($bp-dx) {
          display: inline-block;
          margin-right: ($baseline-v/2);
        }
      }

      // STATE: has error
      &.has--error {
        @include row();
        background: tint($color-error, 90%);

        .message {
          display: block;

          @include media($bp-ds) {
            @include span-columns(3 of 6);
            text-align: left;
          }

          @include media($bp-dm) {
            @include span-columns(6 of 12);
            margin-bottom: 0;
            text-align: left;
          }

          @include media($bp-dl) {
            @include span-columns(6 of 12);
            text-align: left;
          }

          @include media($bp-dx) {
            @include span-columns(6 of 12);
            text-align: left;
          }
        }

        .list--actions {
          display: block;
          margin-bottom: ($baseline-v/2);

          @include media($bp-ds) {
            @include span-columns(3 of 6);
            margin-bottom: 0;
          }

          @include media($bp-dm) {
            @include span-columns(6 of 12);
            margin-bottom: 0;
          }

          @include media($bp-dl) {
            @include span-columns(6 of 12);
            margin-bottom: 0;
          }

          @include media($bp-dx) {
            @include span-columns(6 of 12);
            margin-bottom: 0;
          }
        }
      }
    }
  }


  // --------------------
  // peer assessment
  // --------------------
  .step--peer-assessment {

    .list--peer-assessments {
      @extend %no-list;
    }

    // peer submission
    .peer-assessment__display {
      @extend %ui-section;
    }

    .peer-assessment__display__header {
      @extend %ui-section-title;
      @include clearfix();

      span {
        @extend %t-weight3; // FIX: needed due to DOM structure
      }

      .peer-assessment__display__title {
        @extend %hd-7; // FIX: needed due to DOM structure
        @extend %t-weight3;
        margin-bottom: ($baseline-v/4);

        @include media($bp-ds) {
          float: left;
          margin-bottom: 0;
        }

        @include media($bp-dm) {
          float: left;
          margin-bottom: 0;
        }

        @include media($bp-dl) {
          float: left;
          margin-bottom: 0;
        }

        @include media($bp-dx) {
          float: left;
          margin-bottom: 0;
        }
      }

      .peer-assessment__expected-time {
        @extend %hd-7;  // FIX: needed due to DOM structure
        @extend %t-weight3;

        @include media($bp-ds) {
          float: right;
        }

        @include media($bp-dm) {
          float: right;
        }

        @include media($bp-dl) {
          float: right;
        }

        @include media($bp-dx) {
          float: right;
        }
      }
    }

    .peer-assessment__display__response {
      @extend %ui-section-content;
      @extend %copy-3;
      @extend %ui-content-longanswer;
    }

    // assessment form
    .peer-assessment__assessment {

      // fields
      .assessment__fields {
        margin-bottom: $baseline-v;
      }

      // rubric question
      .assessment__rubric__question {
        @extend %ui-rubric-question;
      }

      // rubric options
      .question__answers {
        @extend %ui-rubric-answers;
      }

      // genereal feedback question
      .assessment__rubric__question--feedback {

        textarea {
          @extend %ui-content-longanswer;
          min-height: ($baseline-v*5);
        }
      }
    }

    // step actions
    .peer-assessment__actions {
      @include transition(background-color $tmg-f1 ease-in-out 0s);
      border-radius: ($baseline-v/5);
      padding: ($baseline-v/2) ($baseline-h/2);
      background: transparent;
      text-align: center;

      @include media($bp-ds) {
        text-align: right;
      }

      @include media($bp-dm) {
       text-align: right;
      }

      @include media($bp-dl) {
        text-align: right;
      }

      @include media($bp-dx) {
        text-align: right;
      }

      .action--submit {
        @extend %btn--primary;
        @extend %action-4;
      }

      // STATE: has error
      &.has--error {
        @include row();
        background: tint($color-error, 90%);

        .message {
          display: block;
          margin-bottom: ($baseline-v/2);

          @include media($bp-ds) {
            @include span-columns(3 of 6);
            margin-bottom: 0;
            text-align: left;
          }

          @include media($bp-dm) {
            @include span-columns(6 of 12);
            margin-bottom: 0;
            text-align: left;
          }

          @include media($bp-dl) {
            @include span-columns(6 of 12);
            margin-bottom: 0;
            text-align: left;
          }

          @include media($bp-dx) {
            @include span-columns(6 of 12);
            margin-bottom: 0;
            text-align: left;
          }
        }

        .list--actions {
          display: block;

          @include media($bp-ds) {
            @include span-columns(3 of 6);
          }

          @include media($bp-dm) {
            @include span-columns(6 of 12);
          }

          @include media($bp-dl) {
            @include span-columns(6 of 12);
          }

          @include media($bp-dx) {
            @include span-columns(6 of 12);
          }
        }
      }
    }
  }


  // --------------------
  // self assessment
  // --------------------
  .step--self-assessment {

    // submission
    .self-assessment__display {
      @extend %ui-section;
    }

    .self-assessment__display__header {
      @extend %ui-section-title;
      @include clearfix();

      span {
        @extend %t-weight3; // FIX: needed due to DOM structure
      }

      .self-assessment__display__title {
        @extend %hd-7; // FIX: needed due to DOM structure
        @extend %t-weight3;
        float: left;
      }
    }

    .self-assessment__display__response {
      @extend %copy-3;
      @extend %ui-content-longanswer;
      @extend %ui-section-content;
    }

    // assessment form
    .self-assessment__assessment {

      // fields
      .assessment__fields {
        margin-bottom: $baseline-v;
      }

      // rubric question
      .assessment__rubric__question {
        @extend %ui-rubric-question;
      }

      // rubric options
      .question__answers {
        @extend %ui-rubric-answers;
      }

      // genereal feedback question
      .assessment__rubric__question--feedback {

        textarea {
          @extend %ui-content-longanswer;
          min-height: ($baseline-v*5);
        }
      }
    }

    // step actions
    .self-assessment__actions {
      @include transition(background-color $tmg-f1 ease-in-out 0s);
      border-radius: ($baseline-v/5);
      padding: ($baseline-v/2) ($baseline-h/2);
      background: transparent;
      text-align: center;

      @include media($bp-ds) {
        text-align: right;
      }

      @include media($bp-dm) {
       text-align: right;
      }

      @include media($bp-dl) {
        text-align: right;
      }

      @include media($bp-dx) {
        text-align: right;
      }

      .action--submit {
        @extend %btn--primary;
        @extend %action-4;
      }

      // STATE: has error
      &.has--error {
        @include row();
        background: tint($color-error, 90%);

        .message {
          display: block;
          margin-bottom: ($baseline-v/2);

          @include media($bp-ds) {
            @include span-columns(3 of 6);
            margin-bottom: 0;
            text-align: left;
          }

          @include media($bp-dm) {
            @include span-columns(6 of 12);
            margin-bottom: 0;
            text-align: left;
          }

          @include media($bp-dl) {
            @include span-columns(6 of 12);
            margin-bottom: 0;
            text-align: left;
          }

          @include media($bp-dx) {
            @include span-columns(6 of 12);
            margin-bottom: 0;
            text-align: left;
          }
        }

        .list--actions {
          display: block;

          @include media($bp-ds) {
            @include span-columns(3 of 6);
          }

          @include media($bp-dm) {
            @include span-columns(6 of 12);
          }

          @include media($bp-dl) {
            @include span-columns(6 of 12);
          }

          @include media($bp-dx) {
            @include span-columns(6 of 12);
          }
        }
      }
    }
  }


  // --------------------
  // grade status
  // --------------------
  .step--grade {

    .step__header {
      opacity: 1.0 !important;
    }

    .step__title {

      @include media($bp-ds) {
        @include span-columns(6 of 6);
      }

      @include media($bp-dm) {
        @include span-columns(12 of 12);
      }

      @include media($bp-dl) {
        @include span-columns(12 of 12);
      }

      @include media($bp-dx) {
        @include span-columns(12 of 12);
      }

      .wrapper--copy {
        display: block;
      }

      .step__label, .grade__value {
        display: inline-block;
        vertical-align: middle;
      }

      .step__label {
        margin-right: ($baseline-h/2);
        margin-bottom: ($baseline-v/4);
        color: $color-decorative-secondary;
      }


      .grade__value {
        border-radius: ($baseline-v/10);
        padding: ($baseline-v/2) ($baseline-h/2);
        background: $color-decorative-tertiary;
      }

      .grade__value__title {
        @extend %hd-6;
      }

      .grade__value__description {
        @extend %copy-4;
      }
    }

    .grade__summary {
      @extend %copy-2;
    }

    .grade__status {

    }

    // CASE: is not started
    &.is--unstarted {
      display: none;
    }

    // CASE: is incomplete
    &.is--incomplete {

      .step__header {
        border-bottom: none;
        padding: 0;
      }
    }

    // CASE: is complete
    &.is--complete {

      .grade__value {
        background: $color-complete;
        color: $white;
      }

      .grade__value__earned, .grade__value__potential {
        @extend %t-weight3;
      }
    }
  }

  // --------------------
  // UI: submitted repsonse
  // --------------------
  .submission__answer__display {
    @extend %ui-section;
  }

  .submission__answer__display__title {
    @extend %ui-section-title;
  }

  .submission__answer__display__content {
    @extend %copy-3;
    @extend %ui-content-longanswer;
    @extend %ui-section-content;
  }


  // --------------------
  // UI: displayed peer assessments
  // --------------------

  // peer review summary
  .submission__peer-evaluations {
    @extend %ui-section;
  }

  .submission__peer-evaluations__title {
    @extend %ui-section-title;
  }

  // rubric questions
  .submission__peer-evaluations__questions {
    @extend %no-list;
    @extend %ui-section-content;
    margin-bottom: ($baseline-v/2);

    &:last-child {
      margin-bottom: 0;
      border-bottom: none;
      padding-bottom: 0;
    }

    // individual question
    .question {
      margin-bottom: ($baseline-v/2);
      @extend %wipe-last-child;
    }

    .question__title {
      @include clearfix();
      margin-bottom: $baseline-v;
      border-bottom: ($baseline-v/10) solid $color-decorative-tertiary;
      padding-bottom: ($baseline-v/4);
    }

    .question__title__copy {
      @extend %hd-4;
      @extend %t-weight3;
      float: left;
    }

    .question__score {
      @extend %copy-6;
      @extend %t-titlecase;
      float: right;
      position: relative;
      bottom: -(($baseline-v/4));
      margin-left: $baseline-v;
      padding: ($baseline-v/4) ($baseline-v/2) (($baseline-v/4)/2)  ($baseline-v/2);
      background: $color-decorative-tertiary;
      color: $white;
    }

    .question__score__value {
      color: $color-complete;

      &:after {
        content: "/";
        margin-left: ($baseline-v/4);
        color: $heading-secondary-color;
      }
    }

    .question__score__potential {
      color: $heading-secondary-color;

      .unit {
        margin-left: ($baseline-v/4);
      }
    }

    .question__answers {
      @extend %no-list;
      @extend %wipe-last-child;
      @include row();
    }

    // individual answers
    .answer {
      margin-bottom: $baseline-v;

      @include media($bp-ds) {
        @include span-columns(3 of 6);
        @include omega(2n);
      }

      @include media($bp-dm) {
        @include span-columns(3 of 12);
        @include omega(4n);
      }

      @include media($bp-dl) {
        @include span-columns(3 of 12);
        @include omega(4n);
      }

      @include media($bp-dx) {
        @include span-columns(3 of 12);
        @include omega(4n);
      }
    }

    .answer__source {
      @extend %hd-7;
      display: block;
      color: $heading-tertiary-color;
    }

    .answer__value {
      @extend %copy-3;
      display: block;
      margin-bottom: ($baseline-v/2);
      color: $heading-primary-color;
    }

    .answer__content {
      @extend %copy-4;
      display: block;
      color: $copy-supplemental-color;
    }
  }

  // feedback form
  .submission__feeedback {
    @extend %ui-section;
  }

  .submission__feeedback__title {
    @extend %ui-section-title;
  }

  .submission__feeedback__content {
    @extend %ui-section-content;
  }

  .submission__feeedback__actions {
    @extend %ui-section-content;
    padding-top: 0;

    .action--submit {
      @extend %btn--secondary;
      @extend %action-4;
      margin-right: ($baseline-v/2);
    }
  }

  // --------------------
  // STATE: incomplete
  // --------------------


  // --------------------
  // STATE: waiting
  // --------------------

}
