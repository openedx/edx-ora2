!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=148)}({1:function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s="application/json; charset=utf-8",a=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.runtime=t,this.element=i,this.url=this.url.bind(this),this.render=this.render.bind(this),this.renderLatex=this.renderLatex.bind(this),this.renderContinuedPeer=this.renderContinuedPeer.bind(this),this.studentInfo=this.studentInfo.bind(this),this.staffGradeForm=this.staffGradeForm.bind(this),this.staffGradeCounts=this.staffGradeCounts.bind(this),this.submit=this.submit.bind(this),this.save=this.save.bind(this),this.submitFeedbackOnAssessment=this.submitFeedbackOnAssessment.bind(this),this.submitAssessment=this.submitAssessment.bind(this),this.peerAssess=this.peerAssess.bind(this),this.selfAssess=this.selfAssess.bind(this),this.staffAssess=this.staffAssess.bind(this),this.trainingAssess=this.trainingAssess.bind(this),this.scheduleTraining=this.scheduleTraining.bind(this),this.rescheduleUnfinishedTasks=this.rescheduleUnfinishedTasks.bind(this),this.updateEditorContext=this.updateEditorContext.bind(this),this.checkReleased=this.checkReleased.bind(this),this.getUploadUrl=this.getUploadUrl.bind(this),this.removeUploadedFile=this.removeUploadedFile.bind(this),this.saveFilesDescriptions=this.saveFilesDescriptions.bind(this),this.getDownloadUrl=this.getDownloadUrl.bind(this),this.cancelSubmission=this.cancelSubmission.bind(this),this.publishEvent=this.publishEvent.bind(this),this.getTeamDetail=this.getTeamDetail.bind(this),this.listTeams=this.listTeams.bind(this),this.getUsername=this.getUsername.bind(this)}var t,i,a;return t=e,(i=[{key:"url",value:function(e){return this.runtime.handlerUrl(this.element,e)}},{key:"render",value:function(e){var t=this,i=this.url("render_".concat(e));return $.Deferred((function(e){$.ajax({url:i,type:"POST",dataType:"html"}).done((function(i){e.resolveWith(t,[i])})).fail((function(){e.rejectWith(t,[gettext("This section could not be loaded.")])}))})).promise()}},{key:"renderLatex",value:function(e){e.filter(".allow--latex").each((function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub,this])}))}},{key:"renderContinuedPeer",value:function(){var e=this,t=this.url("render_peer_assessment");return $.Deferred((function(i){$.ajax({url:t,type:"POST",dataType:"html",data:{continue_grading:!0}}).done((function(t){i.resolveWith(e,[t])})).fail((function(){i.rejectWith(e,[gettext("This section could not be loaded.")])}))})).promise()}},{key:"studentInfo",value:function(e,t){var i=this.url("render_student_info");return $.Deferred((function(n){$.ajax({url:i,type:"POST",dataType:"html",data:_.extend({student_username:e},t)}).done((function(e){n.resolveWith(this,[e])})).fail((function(){n.rejectWith(this,[gettext("This section could not be loaded.")])}))})).promise()}},{key:"staffGradeForm",value:function(){var e=this.url("render_staff_grade_form");return $.Deferred((function(t){$.ajax({url:e,type:"POST",dataType:"html"}).done((function(e){t.resolveWith(this,[e])})).fail((function(){t.rejectWith(this,[gettext("The staff assessment form could not be loaded.")])}))})).promise()}},{key:"staffGradeCounts",value:function(){var e=this.url("render_staff_grade_counts");return $.Deferred((function(t){$.ajax({url:e,type:"POST",dataType:"html"}).done((function(e){t.resolveWith(this,[e])})).fail((function(){t.rejectWith(this,[gettext("The display of ungraded and checked out responses could not be loaded.")])}))})).promise()}},{key:"submit",value:function(e){var t=this.url("submit");return $.Deferred((function(i){$.ajax({type:"POST",url:t,data:JSON.stringify({submission:e}),contentType:s}).done((function(e){if(e[0]){var t=e[1],n=e[2];i.resolveWith(this,[t,n])}else{var s=e[1],a=e[2];i.rejectWith(this,[s,a])}})).fail((function(){i.rejectWith(this,["AJAX",gettext("This response could not be submitted.")])}))})).promise()}},{key:"save",value:function(e){var t=this.url("save_submission");return $.Deferred((function(i){$.ajax({type:"POST",url:t,data:JSON.stringify({submission:e}),contentType:s}).done((function(e){e.success?i.resolve():i.rejectWith(this,[e.msg])})).fail((function(){i.rejectWith(this,[gettext("This response could not be saved.")])}))})).promise()}},{key:"submitFeedbackOnAssessment",value:function(e,t){var i=this.url("submit_feedback"),n=JSON.stringify({feedback_text:e,feedback_options:t});return $.Deferred((function(e){$.ajax({type:"POST",url:i,data:n,contentType:s}).done((function(t){t.success?e.resolve():e.rejectWith(this,[t.msg])})).fail((function(){e.rejectWith(this,[gettext("This feedback could not be submitted.")])}))})).promise()}},{key:"submitAssessment",value:function(e,t){var i=this.url(e);return $.Deferred((function(e){$.ajax({type:"POST",url:i,data:JSON.stringify(t),contentType:s}).done((function(t){t.success?e.resolve():e.rejectWith(this,[t.msg])})).fail((function(){e.rejectWith(this,[gettext("This assessment could not be submitted.")])}))})).promise()}},{key:"peerAssess",value:function(e,t,i,n){return this.submitAssessment("peer_assess",{options_selected:e,criterion_feedback:t,overall_feedback:i,submission_uuid:n})}},{key:"selfAssess",value:function(e,t,i){return this.submitAssessment("self_assess",{options_selected:e,criterion_feedback:t,overall_feedback:i})}},{key:"staffAssess",value:function(e,t,i,n,s){return this.submitAssessment("staff_assess",{options_selected:e,criterion_feedback:t,overall_feedback:i,submission_uuid:n,assess_type:s})}},{key:"trainingAssess",value:function(e){var t=this.url("training_assess"),i=JSON.stringify({options_selected:e});return $.Deferred((function(e){$.ajax({type:"POST",url:t,data:i,contentType:s}).done((function(t){t.success?e.resolveWith(this,[t.corrections]):e.rejectWith(this,[t.msg])})).fail((function(){e.rejectWith(this,[gettext("This assessment could not be submitted.")])}))}))}},{key:"scheduleTraining",value:function(){var e=this.url("schedule_training");return $.Deferred((function(t){$.ajax({type:"POST",url:e,data:'""',contentType:s}).done((function(e){e.success?t.resolveWith(this,[e.msg]):t.rejectWith(this,[e.msg])})).fail((function(){t.rejectWith(this,[gettext("This assessment could not be submitted.")])}))}))}},{key:"rescheduleUnfinishedTasks",value:function(){var e=this.url("reschedule_unfinished_tasks");return $.Deferred((function(t){$.ajax({type:"POST",url:e,data:'""',contentType:s}).done((function(e){e.success?t.resolveWith(this,[e.msg]):t.rejectWith(this,[e.msg])})).fail((function(){t.rejectWith(this,[gettext("One or more rescheduling tasks failed.")])}))}))}},{key:"updateEditorContext",value:function(e){var t=this.url("update_editor_context"),i=JSON.stringify({prompts:e.prompts,prompts_type:e.prompts_type,feedback_prompt:e.feedbackPrompt,feedback_default_text:e.feedback_default_text,title:e.title,submission_start:e.submissionStart,submission_due:e.submissionDue,criteria:e.criteria,assessments:e.assessments,editor_assessments_order:e.editorAssessmentsOrder,text_response:e.textResponse,file_upload_response:e.fileUploadResponse,file_upload_type:e.fileUploadType,white_listed_file_types:e.fileTypeWhiteList,allow_multiple_files:e.multipleFileEnabled,allow_latex:e.latexEnabled,leaderboard_show:e.leaderboardNum,teams_enabled:e.teamsEnabled,selected_teamset_id:e.selectedTeamsetId});return $.Deferred((function(e){$.ajax({type:"POST",url:t,data:i,contentType:s}).done((function(t){t.success?e.resolve():e.rejectWith(this,[t.msg])})).fail((function(){e.rejectWith(this,[gettext("This problem could not be saved.")])}))})).promise()}},{key:"checkReleased",value:function(){var e=this.url("check_released");return $.Deferred((function(t){$.ajax({type:"POST",url:e,data:'""',contentType:s}).done((function(e){e.success?t.resolveWith(this,[e.is_released]):t.rejectWith(this,[e.msg])})).fail((function(){t.rejectWith(this,[gettext("The server could not be contacted.")])}))})).promise()}},{key:"getUploadUrl",value:function(e,t,i){var n=this.url("upload_url");return $.Deferred((function(a){$.ajax({type:"POST",url:n,data:JSON.stringify({contentType:e,filename:t,filenum:i}),contentType:s}).done((function(e){e.success?a.resolve(e.url):a.rejectWith(this,[e.msg])})).fail((function(){a.rejectWith(this,[gettext("Could not retrieve upload url.")])}))})).promise()}},{key:"removeUploadedFile",value:function(e){var t=this.url("remove_uploaded_file");return $.Deferred((function(i){$.ajax({type:"POST",url:t,data:JSON.stringify({filenum:e}),contentType:s}).done((function(e){e.success?i.resolve():i.rejectWith(this,[e.msg])})).fail((function(){i.rejectWith(this,[gettext("Server error.")])}))})).promise()}},{key:"saveFilesDescriptions",value:function(e){var t=this.url("save_files_descriptions");return $.Deferred((function(i){$.ajax({type:"POST",url:t,data:JSON.stringify({fileMetadata:e}),contentType:s}).done((function(e){e.success?i.resolve():i.rejectWith(this,[e.msg])})).fail((function(){i.rejectWith(this,[gettext("Server error.")])}))})).promise()}},{key:"getDownloadUrl",value:function(e){var t=this.url("download_url");return $.Deferred((function(i){$.ajax({type:"POST",url:t,data:JSON.stringify({filenum:e}),contentType:s}).done((function(e){e.success?i.resolve(e.url):i.rejectWith(this,[e.msg])})).fail((function(){i.rejectWith(this,[gettext("Could not retrieve download url.")])}))})).promise()}},{key:"cancelSubmission",value:function(e,t){var i=this.url("cancel_submission"),n=JSON.stringify({submission_uuid:e,comments:t});return $.Deferred((function(e){$.ajax({type:"POST",url:i,data:n,contentType:s}).done((function(t){t.success&&e.resolveWith(this,[t.msg])})).fail((function(){e.rejectWith(this,[gettext("The submission could not be removed from the grading pool.")])}))})).promise()}},{key:"publishEvent",value:function(e,t){t.event_name=e;var i=this.url("publish_event"),n=JSON.stringify(t);$.ajax({type:"POST",url:i,data:n,contentType:s})}},{key:"getTeamDetail",value:function(e){var t="".concat(window.location.origin,"/api/team/v0/teams/").concat(e);return $.ajax({type:"GET",url:t,contentType:s})}},{key:"listTeams",value:function(e,t){var i="".concat(window.location.origin,"/api/team/v0/teams/");return $.Deferred((function(n){$.ajax({type:"GET",url:i,data:{course_id:t,username:e},contentType:s}).done((function(e){e.count>1?n.rejectWith(this,[gettext("Multiple teams returned for course")]):0===e.count?n.resolveWith(this,[null]):n.resolveWith(this,[e.results[0]])})).fail((function(){n.rejectWith(this,[gettext("Could not load teams information.")])}))})).promise()}},{key:"getUsername",value:function(){var e=this.url("get_student_username");return $.Deferred((function(t){$.ajax({type:"POST",url:e,data:JSON.stringify({}),contentType:s}).done((function(e){null===e.username?t.rejectWith(this,[gettext("User lookup failed")]):t.resolveWith(this,[e.username])})).fail((function(){t.rejectWith(this,[gettext("Error when looking up username")])}))}))}}])&&n(t.prototype,i),a&&n(t,a),e}();t.a=a},148:function(e,t,i){"use strict";i.r(t);i(2);function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=$("#openassessment_validation_alert"),this.editorElement=$(this.element).parent(),this.title=$(".openassessment_alert_title",this.element),this.message=$(".openassessment_alert_message",this.element),this.closeButton=$(".openassessment_alert_close",this.element),this.ALERT_YELLOW="rgb(192, 172, 0)",this.DARK_GREY="#323232"}var t,i,s;return t=e,(i=[{key:"install",value:function(){var e=this;return this.closeButton.click((function(t){t.preventDefault(),e.hide()})),this}},{key:"hide",value:function(){var e=$("#openassessment_editor_header",this.editorElement).outerHeight();this.element.addClass("covered");var t={height:"Calc(100% - ".concat(e,"px)"),"border-top-right-radius":"3px","border-top-left-radius":"3px"};return $(".oa_editor_content_wrapper",this.editorElement).each((function(){$(this).css(t)})),this}},{key:"show",value:function(){var e=this;if(this.isVisible())$(this.element).animate({"background-color":e.ALERT_YELLOW},300,"swing",(function(){$(this).animate({"background-color":e.DARK_GREY},700,"swing")}));else{this.element.removeClass("covered");var t=this.element.outerHeight(),i=$("#openassessment_editor_header",this.editorElement).outerHeight(),n={height:"Calc(100% - ".concat(t+i,"px)"),"border-top-right-radius":"0px","border-top-left-radius":"0px"};$(".oa_editor_content_wrapper",this.editorElement).each((function(){$(this).css(n),$(this).scrollTop($(this).scrollTop()+t)}))}return this}},{key:"setMessage",value:function(e,t){return this.title.text(e),this.message.text(t),this}},{key:"isVisible",value:function(){return!this.element.hasClass("covered")}},{key:"getTitle",value:function(){return this.title.text()}},{key:"getMessage",value:function(){return this.message.text()}}])&&n(t.prototype,i),s&&n(t,s),e}();function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.containerElement=i.containerElement,this.templateElement=i.templateElement,this.addButtonElement=i.addButtonElement,this.removeButtonClass=i.removeButtonClass,this.containerItemClass=i.containerItemClass,this.notifier=i.notifier,this.addRemoveEnabled=void 0===i.addRemoveEnabled||i.addRemoveEnabled;var n=this;this.createContainerItem=function(e){return new t(e,n.notifier)}}var t,i,n;return t=e,(i=[{key:"addEventListeners",value:function(){var e=this;this.addRemoveEnabled?($(this.addButtonElement).click($.proxy(this.add,this)),$(".".concat(this.removeButtonClass),this.containerElement).click((function(t){var i=e.createContainerItem(t.target);e.remove(i)}))):($(this.addButtonElement).addClass("is--disabled"),$(".".concat(this.removeButtonClass),this.containerElement).addClass("is--disabled")),$(".".concat(this.containerItemClass),this.containerElement).each((function(t,i){e.createContainerItem(i).addEventListeners()}))}},{key:"add",value:function(){$(this.templateElement).children().first().clone().removeAttr("id").toggleClass("is--hidden",!1).toggleClass(this.containerItemClass,!0).appendTo($(this.containerElement));var e=this,t=$(".".concat(this.containerItemClass),this.containerElement).last();this.addRemoveEnabled?t.find(".".concat(this.removeButtonClass)).click((function(t){var i=e.createContainerItem(t.target);e.remove(i)})):t.find(".".concat(this.removeButtonClass)).addClass("is--disabled");var i=e.createContainerItem(t);i.addEventListeners(),i.addHandler()}},{key:"remove",value:function(e){var t=$(e.element).closest(".".concat(this.containerItemClass));this.createContainerItem(t).removeHandler(),t.remove()}},{key:"getItemValues",value:function(){var e=[],t=this;return $(".".concat(this.containerItemClass),this.containerElement).each((function(i,n){var s=t.createContainerItem(n).getFieldValues();e.push(s)})),e}},{key:"getItem",value:function(e){var t=$(".".concat(this.containerItemClass),this.containerElement).get(e);return void 0!==t?this.createContainerItem(t):null}},{key:"getAllItems",value:function(){var e=this;return $(".".concat(this.containerItemClass),this.containerElement).map((function(){return e.createContainerItem(this)}))}}])&&a(t.prototype,i),n&&a(t,n),e}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,i){return t&&l(e.prototype,t),i&&l(e,i),e}var d=function(e,t){return void 0!==t&&e.val(t),e.val()},c=function(e,t){return void 0!==t&&e.prop("checked",t),e.prop("checked")},h=function(){function e(t,i){o(this,e),this.max=i.max,this.min=i.min,this.input=$(t)}return u(e,[{key:"get",value:function(){return parseInt(this.input.val().trim(),10)}},{key:"set",value:function(e){this.input.val(e)}},{key:"validate",value:function(){var e=this.get(),t=!Number.isNaN(e)&&e>=this.min&&e<=this.max;return-1!==this.input.val().indexOf(".")&&(t=!1),t||this.input.addClass("openassessment_highlighted_field"),t}},{key:"clearValidationErrors",value:function(){this.input.removeClass("openassessment_highlighted_field")}},{key:"validationErrors",value:function(){return this.input.hasClass("openassessment_highlighted_field")?["Int field is invalid"]:[]}}]),e}(),m=function(){function e(t,i,n,s){o(this,e),this.checkbox=t,this.shownSections=i,this.hiddenSections=n,this.notifier=s}return u(e,[{key:"install",value:function(){return this.checkbox.change(this,(function(e){var t=e.data;this.checked?(t.notifier.notificationFired("toggleOn",{}),t.show()):(t.notifier.notificationFired("toggleOff",{}),t.hide())})),this}},{key:"show",value:function(){$.each(this.hiddenSections,(function(e,t){t.addClass("is--hidden")})),$.each(this.shownSections,(function(e,t){t.removeClass("is--hidden")}))}},{key:"hide",value:function(){$.each(this.shownSections,(function(e,t){t.addClass("is--hidden")})),$.each(this.hiddenSections,(function(e,t){t.removeClass("is--hidden")}))}}]),e}(),p=function(){function e(t,i,n){o(this,e),this.element=t,this.datePicker=i,this.timePicker=n}return u(e,[{key:"install",value:function(){var e=$(this.datePicker,this.element).val();return $(this.datePicker,this.element).datepicker({showButtonPanel:!0}).datepicker("option","dateFormat","yy-mm-dd").datepicker("setDate",e),$(this.timePicker,this.element).timepicker({timeFormat:"H:i",step:60}),this}},{key:"datetime",value:function(e,t){var i=$(this.datePicker,this.element),n=$(this.timePicker,this.element);return void 0!==e&&i.val(e),void 0!==t&&n.val(t),"".concat(i.val(),"T").concat(n.val())}},{key:"validate",value:function(){var e=$(this.datePicker,this.element).val(),t=$(this.timePicker,this.element).val(),i=!1;try{i=$.datepicker.parseDate($.datepicker.ISO_8601,e)instanceof Date}catch(e){}i||$(this.datePicker,this.element).addClass("openassessment_highlighted_field");var n=null!==t.match(/^\d{2}:\d{2}$/g);return n||$(this.timePicker,this.element).addClass("openassessment_highlighted_field"),i&&n}},{key:"clearValidationErrors",value:function(){$(this.datePicker,this.element).removeClass("openassessment_highlighted_field"),$(this.timePicker,this.element).removeClass("openassessment_highlighted_field")}},{key:"validationErrors",value:function(){var e=[],t=$(this.datePicker,this.element).hasClass("openassessment_highlighted_field"),i=$(this.timePicker,this.element).hasClass("openassessment_highlighted_field");return t&&e.push("Date is invalid"),i&&e.push("Time is invalid"),e}}]),e}(),f=function(){function e(t,i,n){o(this,e),this.select=t,this.mapping=i,this.notifier=n}return u(e,[{key:"install",value:function(){return this.select.change(this,(function(e){var t=e.data;t.notifier.notificationFired("selectionChanged",{selected:this.value}),t.change(this.value)})),this}},{key:"change",value:function(e){$.isFunction(this.mapping)?this.mapping(e):$.each(this.mapping,(function(t,i){t===e?i.removeClass("is--hidden"):i.addClass("is--hidden")}))}}]),e}(),v=function(){function e(t,i){o(this,e),this.input=$(t),this.validator=i,this.errors=[]}return u(e,[{key:"get",value:function(){return this.input.val()}},{key:"set",value:function(e){this.input.val(e)}},{key:"validate",value:function(){return this.errors=this.validator(this.get()),this.errors.length&&(this.input.addClass("openassessment_highlighted_field"),this.input.parent().nextAll(".message-status").text(this.errors.join(";")),this.input.parent().nextAll(".message-status").addClass("is-shown")),0===this.errors.length}},{key:"clearValidationErrors",value:function(){this.input.removeClass("openassessment_highlighted_field"),this.input.parent().nextAll(".message-status").removeClass("is-shown")}},{key:"validationErrors",value:function(){return this.errors}}]),e}(),g=function(e){var t=e.base_asset_url,i=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return function(e){e.src&&(e.src=rewriteStaticLinks.apply(void 0,[e.src].concat(i)))}};return{height:"300",font_formats:"Default='Open Sans', Verdana, Arial, Helvetica, sans-serif;Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats",theme:"modern",skin:"studio-tmce4",schema:"html5",convert_urls:!1,directionality:$(".wrapper-view, .window-wrap").prop("dir"),formats:{code:{inline:"code"}},visual:!1,plugins:"textcolor, link, image, media",image_advtab:!0,toolbar:"formatselect | fontselect | bold italic underline forecolor | bullist numlist outdent indent blockquote | link unlink image media",block_formats:"".concat(gettext("Paragraph"),"=p;").concat(gettext("Preformatted"),"=pre;").concat(gettext("Heading 3"),"=h3;").concat(gettext("Heading 4"),"=h4;").concat(gettext("Heading 5"),"=h5;").concat(gettext("Heading 6"),"=h6"),menubar:!1,statusbar:!1,valid_children:"+body[style]",valid_elements:"*[*]",extended_valid_elements:"*[*]",invalid_elements:"",setup:function(e){e.on("SaveImage",i("src",t,"/static")),e.on("EditImage",i("src","/static",t)),e.on("SaveLink",i("html",t,"/static")),e.on("EditLink",i("html","/static",t))},init_instance_callback:function(e){return e.setContent(rewriteStaticLinks(e.getContent({no_events:1}),"/static/",t)),e.focus()},browser_spellcheck:!0}};function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function k(e,t,i){return t&&b(e.prototype,t),i&&b(e,i),e}var w=function(e,t){for(var i=0;i<=e.length;){if(0===e.parent().find("*[".concat(t,"='").concat(i,"']")).length)return i.toString();i++}return i.toString()},E=function(e){var t=$(e).attr("data-points"),i=$(e).attr("data-label"),n=$(e).val();""===i&&(i=gettext("Unnamed Option"));var s="".concat(i," - ").concat(t," point"),a="".concat(i," - ").concat(t," points"),r="";r=""===n?gettext("Not Selected"):Number.isNaN(t)||"NaN"===t?i:ngettext(s,a,t),$(e).text(r)},C=function(){function e(t,i){y(this,e),this.tinyMCEEnabled&&(t=this.attachWysiwygToPrompt(t)),this.element=t,this.notifier=i,this.tinyMCEEnabled=void 0!==window.tinyMCE}return k(e,[{key:"attachWysiwygToPrompt",value:function(e){if(!$(e).find("textarea").attr("id")){var t=$(e).find("textarea"),i=$(t).val(),n=$(t).data("type");i&&"text"===n&&(i=_.escape(i).replace(/(?:\r\n|\r|\n)/g,"<br />"),$(t).val(i));var s="".concat(Date.now(),"-textarea-").concat(100*Math.random());$(t).attr("id",s).tinymce(g({base_asset_url:$("#openassessment_prompt_template").data("baseAssetUrl")}))}return $(e)}},{key:"getFieldValues",value:function(){return{description:this.description()}}},{key:"description",value:function(e){var t=$(".openassessment_prompt_description",this.element);if(!this.tinyMCEEnabled)return d(t,e);var i=window.tinyMCE.get(t.attr("id"));if(!e)return i.getContent();i.setContent(e)}},{key:"addEventListeners",value:function(){}},{key:"addHandler",value:function(){this.notifier.notificationFired("promptAdd",{index:this.element.index()})}},{key:"removeHandler",value:function(){this.notifier.notificationFired("promptRemove",{index:this.element.index()})}},{key:"updateHandler",value:function(){}},{key:"validate",value:function(){return!0}},{key:"validationErrors",value:function(){return[]}},{key:"clearValidationErrors",value:function(){}}]),e}(),x=function(){function e(t,i){y(this,e),this.element=t,this.notifier=i,this.pointsField=new h($(".openassessment_criterion_option_points",this.element),{min:0,max:999})}return k(e,[{key:"addEventListeners",value:function(){$(this.element).focusout($.proxy(this.updateHandler,this))}},{key:"getFieldValues",value:function(){var e={label:this.label(),points:this.points(),explanation:this.explanation()},t=d($(".openassessment_criterion_option_name",this.element));return""!==t&&(e.name=t),e}},{key:"label",value:function(e){var t=$(".openassessment_criterion_option_label",this.element);return d(t,e)}},{key:"points",value:function(e){return void 0!==e&&this.pointsField.set(e),this.pointsField.get()}},{key:"explanation",value:function(e){var t=$(".openassessment_criterion_option_explanation",this.element);return d(t,e)}},{key:"addHandler",value:function(){var e=$(this.element).closest(".openassessment_criterion"),t=$(e).data("criterion"),i=$(".openassessment_criterion_label",e).val(),n=$(".openassessment_criterion_option",this.element.parent()),s=w(n,"data-option");$(this.element).attr("data-criterion",t).attr("data-option",s),$(".openassessment_criterion_option_name",this.element).attr("value",s);var a=this.getFieldValues();this.notifier.notificationFired("optionAdd",{criterionName:t,criterionLabel:i,name:s,label:a.label,points:a.points})}},{key:"removeHandler",value:function(){var e=$(this.element).data("criterion"),t=$(this.element).data("option");this.notifier.notificationFired("optionRemove",{criterionName:e,name:t})}},{key:"updateHandler",value:function(){var e=this.getFieldValues(),t=$(this.element).data("criterion"),i=$(this.element).data("option"),n=e.label,s=e.points;this.notifier.notificationFired("optionUpdated",{criterionName:t,name:i,label:n,points:s})}},{key:"validate",value:function(){return this.pointsField.validate()}},{key:"validationErrors",value:function(){return this.pointsField.validationErrors().length>0?["Option points are invalid"]:[]}},{key:"clearValidationErrors",value:function(){this.pointsField.clearValidationErrors()}}]),e}(),T=function(){function e(t,i){y(this,e),this.element=t,this.notifier=i,this.labelSel=$(".openassessment_criterion_label",this.element),this.promptSel=$(".openassessment_criterion_prompt",this.element),this.optionContainer=new r(x,{containerElement:$(".openassessment_criterion_option_list",this.element).get(0),templateElement:$("#openassessment_option_template").get(0),addButtonElement:$(".openassessment_criterion_add_option",this.element).get(0),removeButtonClass:"openassessment_criterion_option_remove_button",containerItemClass:"openassessment_criterion_option",notifier:this.notifier})}return k(e,[{key:"addEventListeners",value:function(){this.optionContainer.addEventListeners(),$(this.element).focusout($.proxy(this.updateHandler,this))}},{key:"getFieldValues",value:function(){var e={label:this.label(),prompt:this.prompt(),feedback:this.feedback(),options:this.optionContainer.getItemValues()},t=d($(".openassessment_criterion_name",this.element));return""!==t&&(e.name=t),e}},{key:"label",value:function(e){return d(this.labelSel,e)}},{key:"prompt",value:function(e){return d(this.promptSel,e)}},{key:"feedback",value:function(){return $(".openassessment_criterion_feedback",this.element).val()}},{key:"addOption",value:function(){this.optionContainer.add()}},{key:"addHandler",value:function(){var e=$(".openassessment_criterion",this.element.parent()),t=w(e,"data-criterion");$(this.element).attr("data-criterion",t),$(".openassessment_criterion_name",this.element).attr("value",t)}},{key:"removeHandler",value:function(){var e=$(this.element).data("criterion");this.notifier.notificationFired("criterionRemove",{criterionName:e})}},{key:"updateHandler",value:function(){var e=this.getFieldValues(),t=e.name,i=e.label;this.notifier.notificationFired("criterionUpdated",{criterionName:t,criterionLabel:i})}},{key:"validate",value:function(){var e=""!==this.prompt();return e||this.promptSel.addClass("openassessment_highlighted_field"),$.each(this.optionContainer.getAllItems(),(function(){e=this.validate()&&e})),e}},{key:"validationErrors",value:function(){var e=[];return this.promptSel.hasClass("openassessment_highlighted_field")&&e.push("Criterion prompt is invalid."),$.each(this.optionContainer.getAllItems(),(function(){e=e.concat(this.validationErrors())})),e}},{key:"clearValidationErrors",value:function(){this.promptSel.removeClass("openassessment_highlighted_field"),$.each(this.optionContainer.getAllItems(),(function(){this.clearValidationErrors()}))}}]),e}(),S=function(){function e(t){y(this,e),this.element=t,this.criteria=$(".openassessment_training_example_criterion_option",this.element),this.answer=$(".openassessment_training_example_essay_part textarea",this.element)}return k(e,[{key:"getFieldValues",value:function(){var e=this.criteria.map((function(){return{criterion:$(this).data("criterion"),option:$(this).prop("value")}})).get();return{answer:this.answer.map((function(){return $(this).prop("value")})).get(),options_selected:e}}},{key:"addHandler",value:function(){$(".openassessment_training_example_criterion_option",this.element).each((function(){$("option",this).each((function(){E($(this))}))}))}},{key:"addEventListeners",value:function(){}},{key:"removeHandler",value:function(){}},{key:"updateHandler",value:function(){}},{key:"validate",value:function(){var e=!0;return this.criteria.each((function(){var t=""!==$(this).prop("value");e=t&&e,t||$(this).addClass("openassessment_highlighted_field")})),e}},{key:"validationErrors",value:function(){var e=[];return this.criteria.each((function(){$(this).hasClass("openassessment_highlighted_field")&&e.push("Student training example is invalid.")})),e}},{key:"clearValidationErrors",value:function(){this.criteria.each((function(){$(this).removeClass("openassessment_highlighted_field")}))}}]),e}(),V=function(){function e(t,i){y(this,e),this.controlElement=t,this.hiddenElement=i}return k(e,[{key:"install",value:function(){return this.controlElement.click((function(e){e.preventDefault(),this.showHiddenElement(),this.hideSelf()})),this}},{key:"showHiddenElement",value:function(){this.hiddenElement.removeClass("is--hidden")}},{key:"hideSelf",value:function(){this.controlElement.addClass("is--hidden")}}]),e}();function D(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var O=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.editorElement=$(this.element).closest("#openassessment-editor"),this.addRemoveEnabled="true"!==this.editorElement.attr("data-is-released"),this.promptsContainer=new r(C,{containerElement:$("#openassessment_prompts_list",this.element).get(0),templateElement:$("#openassessment_prompt_template",this.element).get(0),addButtonElement:$("#openassessment_prompts_add_prompt",this.element).get(0),removeButtonClass:"openassessment_prompt_remove_button",containerItemClass:"openassessment_prompt",notifier:i,addRemoveEnabled:this.addRemoveEnabled}),this.promptsContainer.addEventListeners()}var t,i,n;return t=e,(i=[{key:"promptsDefinition",value:function(){return this.promptsContainer.getItemValues()}},{key:"promptsType",value:function(){var e=this.promptsContainer.getItem(0);return e&&e.tinyMCEEnabled?"html":"text"}},{key:"addPrompt",value:function(){this.addRemoveEnabled&&this.promptsContainer.add()}},{key:"removePrompt",value:function(e){this.addRemoveEnabled&&this.promptsContainer.remove(e)}},{key:"getAllPrompts",value:function(){return this.promptsContainer.getAllItems()}},{key:"getPromptItem",value:function(e){return this.promptsContainer.getItem(e)}},{key:"validate",value:function(){return!0}},{key:"validationErrors",value:function(){return[]}},{key:"clearValidationErrors",value:function(){}}])&&D(t.prototype,i),n&&D(t,n),e}();function I(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var A=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.criterionAddButton=$("#openassessment_rubric_add_criterion",this.element),this.criteriaContainer=new r(T,{containerElement:$("#openassessment_criterion_list",this.element).get(0),templateElement:$("#openassessment_criterion_template",this.element).get(0),addButtonElement:$("#openassessment_rubric_add_criterion",this.element).get(0),removeButtonClass:"openassessment_criterion_remove_button",containerItemClass:"openassessment_criterion",notifier:i}),this.criteriaContainer.addEventListeners()}var t,i,n;return t=e,(i=[{key:"criteriaDefinition",value:function(){for(var e=this.criteriaContainer.getItemValues(),t=0;t<e.length;t++){var i=e[t];i.order_num=t;for(var n=0;n<i.options.length;n++)i.options[n].order_num=n}return e}},{key:"feedbackPrompt",value:function(e){var t=$("#openassessment_rubric_feedback",this.element);return d(t,e)}},{key:"feedback_default_text",value:function(e){var t=$("#openassessment_rubric_feedback_default_text",this.element);return d(t,e)}},{key:"addCriterion",value:function(){this.criteriaContainer.add()}},{key:"removeCriterion",value:function(e){this.criteriaContainer.remove(e)}},{key:"getAllCriteria",value:function(){return this.criteriaContainer.getAllItems()}},{key:"getCriterionItem",value:function(e){return this.criteriaContainer.getItem(e)}},{key:"addOption",value:function(e){this.getCriterionItem(e).optionContainer.add()}},{key:"removeOption",value:function(e,t){this.getCriterionItem(e).optionContainer.remove(t)}},{key:"getAllOptions",value:function(e){return this.getCriterionItem(e).optionContainer.getAllItems()}},{key:"getOptionItem",value:function(e,t){return this.getCriterionItem(e).optionContainer.getItem(t)}},{key:"validate",value:function(){var e=this.getAllCriteria(),t=e.length>0;return t||this.criterionAddButton.addClass("openassessment_highlighted_field").click((function(){$(this).removeClass("openassessment_highlighted_field")})),$.each(e,(function(){t=this.validate()&&t})),t}},{key:"validationErrors",value:function(){var e=[];return this.criterionAddButton.hasClass("openassessment_highlighted_field")&&e.push("The rubric must contain at least one criterion"),$.each(this.getAllCriteria(),(function(){e=e.concat(this.validationErrors())})),e}},{key:"clearValidationErrors",value:function(){this.criterionAddButton.removeClass("openassessment_highlighted_field"),$.each(this.getAllCriteria(),(function(){this.clearValidationErrors()}))}}])&&I(t.prototype,i),n&&I(t,n),e}();function j(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var P=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.startDatetimeControl=new p(this.element,"#openassessment_submission_start_date","#openassessment_submission_start_time").install(),this.dueDatetimeControl=new p(this.element,"#openassessment_submission_due_date","#openassessment_submission_due_time").install()}var t,i,n;return t=e,(i=[{key:"submissionStart",value:function(e,t){return this.startDatetimeControl.datetime(e,t)}},{key:"submissionDue",value:function(e,t){return this.dueDatetimeControl.datetime(e,t)}},{key:"validate",value:function(){var e=!0;return e=this.startDatetimeControl.validate()&&e,e=this.dueDatetimeControl.validate()&&e}},{key:"validationErrors",value:function(){var e=[];return this.startDatetimeControl.validationErrors().length>0&&e.push("Submission start is invalid"),this.dueDatetimeControl.validationErrors().length>0&&e.push("Submission due is invalid"),e}},{key:"clearValidationErrors",value:function(){this.startDatetimeControl.clearValidationErrors(),this.dueDatetimeControl.clearValidationErrors()}}])&&j(t.prototype,i),n&&j(t,n),e}();function F(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var W=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners=t}var t,i,n;return t=e,(i=[{key:"notificationFired",value:function(e,t){for(var i=0;i<this.listeners.length;i++)"function"==typeof this.listeners[i][e]&&this.listeners[i][e](t)}}])&&F(t.prototype,i),n&&F(t,n),e}();function L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function N(e,t,i){return t&&H(e.prototype,t),i&&H(e,i),e}var B=function(){function e(){L(this,e),this.element=$("#oa_student_training_editor"),this.alert=new s}return N(e,[{key:"promptAdd",value:function(){var e=this.element;$("#openassessment_training_example_part_template").children().first().clone().removeAttr("id").toggleClass("is--hidden",!1).appendTo(".openassessment_training_example_essay",e)}},{key:"promptRemove",value:function(e){var t=this.element;$(".openassessment_training_example_essay li:nth-child(".concat(e.index+1,")"),t).remove()}},{key:"optionUpdated",value:function(e){this._optionSel(e.criterionName).each((function(){var t=$('option[value="'.concat(e.name,'"]'),this).attr("data-points",e.points).attr("data-label",e.label);E(t)}))}},{key:"optionAdd",value:function(e){var t=!1;0===this._optionSel(e.criterionName).length&&(this.criterionAdd(e),t=!0),this._optionSel(e.criterionName).each((function(){var t=$("<option></option>").attr("value",e.name).attr("data-points",e.points).attr("data-label",e.label);E(t),$(this).append(t)})),t&&this.displayAlertMsg(gettext("Criterion Added"),gettext("You have added a criterion. You will need to select an option for the criterion in the Learner Training step. To do this, click the Settings tab."))}},{key:"optionRemove",value:function(e){var t=this,i=!1;this._optionSel(e.criterionName).each((function(){var n=this;$(n).val()===e.name.toString()&&($(n).val("").addClass("openassessment_highlighted_field").click((function(){$(n).removeClass("openassessment_highlighted_field")})),i=!0),$('option[value="'.concat(e.name,'"]'),n).remove(),1===$("option",n).length&&(t.removeAllOptions(e),i=!1)})),i&&this.displayAlertMsg(gettext("Option Deleted"),gettext("You have deleted an option. That option has been removed from its criterion in the sample responses in the Learner Training step. You might have to select a new option for the criterion."))}},{key:"_optionSel",value:function(e){return $('.openassessment_training_example_criterion_option[data-criterion="'.concat(e,'"]'),this.element)}},{key:"removeAllOptions",value:function(e){var t=!1;$(".openassessment_training_example_criterion",this.element).each((function(){$(this).data("criterion")===e.criterionName&&($(this).remove(),t=!0)})),t&&this.displayAlertMsg(gettext("Option Deleted"),gettext("You have deleted all the options for this criterion. The criterion has been removed from the sample responses in the Learner Training step."))}},{key:"criterionRemove",value:function(e){var t=!1,i='.openassessment_training_example_criterion[data-criterion="'.concat(e.criterionName,'"]');$(i,this.element).each((function(){$(this).remove(),t=!0})),t&&this.displayAlertMsg(gettext("Criterion Deleted"),gettext("You have deleted a criterion. The criterion has been removed from the example responses in the Learner Training step."))}},{key:"displayAlertMsg",value:function(e,t){$("#include_student_training",this.element).is(":checked")&&$(".openassessment_training_example",this.element).length>1&&this.alert.setMessage(e,t).show()}},{key:"criterionUpdated",value:function(e){var t='.openassessment_training_example_criterion[data-criterion="'.concat(e.criterionName,'"]');$(t,this.element).each((function(){$(".openassessment_training_example_criterion_name_wrapper",this).text(e.criterionLabel)}))}},{key:"criterionAdd",value:function(e){var t=this.element,i=$("#openassessment_training_example_criterion_template").children().first().clone().removeAttr("id").attr("data-criterion",e.criterionName).toggleClass("is--hidden",!1).appendTo(".openassessment_training_example_criteria_selections",t);i.find(".openassessment_training_example_criterion_option").attr("data-criterion",e.criterionName),i.find(".openassessment_training_example_criterion_name_wrapper").text(e.label)}},{key:"examplesCriteriaLabels",value:function(){var e=[];return $(".openassessment_training_example_criteria_selections",this.element).each((function(){var t={};$(".openassessment_training_example_criterion",this).each((function(){var e=$(this).data("criterion"),i=$(".openassessment_training_example_criterion_name_wrapper",this).text().trim();t[e]=i})),e.push(t)})),e}},{key:"examplesOptionsLabels",value:function(){var e=[];return $(".openassessment_training_example_criteria_selections",this.element).each((function(){var t={};$(".openassessment_training_example_criterion_option",this).each((function(){var e=$(this).data("criterion");t[e]={},$("option",this).each((function(){var i=$(this).val(),n=$(this).text().trim();t[e][i]=n}))})),e.push(t)})),e}}]),e}(),U=function(){function e(){L(this,e),this.alert=new s}return N(e,[{key:"toggleOff",value:function(){this.alert.setMessage(gettext("Warning"),gettext("Changes to steps that are not selected as part of the assignment will not be saved.")).show()}},{key:"toggleOn",value:function(){this.alert.hide()}}]),e}();function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function G(e,t,i){return t&&M(e.prototype,t),i&&M(e,i),e}var J=function(){function e(t,i){R(this,e),this.element=t,this.name="peer-assessment",this.scheduleElement=i,this.mustGradeField=new h($("#peer_assessment_must_grade",this.element),{min:0,max:99}),this.mustBeGradedByField=new h($("#peer_assessment_graded_by",this.element),{min:0,max:99}),new m($("#include_peer_assessment",this.element),[$("#peer_assessment_settings_editor",this.element),$("#peer_assessment_schedule_editor",this.scheduleElement)],[],new W([new U])).install(),new V($("#peer_assessment_settings_editor_show_details",this.element),$("#peer_assessment_settings_editor_details",this.element)).install(),this.startDatetimeControl=new p(this.scheduleElement,"#peer_assessment_start_date","#peer_assessment_start_time").install(),this.dueDatetimeControl=new p(this.scheduleElement,"#peer_assessment_due_date","#peer_assessment_due_time").install()}return G(e,[{key:"description",value:function(){return{must_grade:this.mustGradeNum(),must_be_graded_by:this.mustBeGradedByNum(),start:this.startDatetime(),due:this.dueDatetime()}}},{key:"isEnabled",value:function(e){var t=$("#include_peer_assessment",this.element);return c(t,e)}},{key:"toggleEnabled",value:function(){$("#include_peer_assessment",this.element).click()}},{key:"mustGradeNum",value:function(e){return void 0!==e&&this.mustGradeField.set(e),this.mustGradeField.get()}},{key:"mustBeGradedByNum",value:function(e){return void 0!==e&&this.mustBeGradedByField.set(e),this.mustBeGradedByField.get()}},{key:"startDatetime",value:function(e,t){return this.startDatetimeControl.datetime(e,t)}},{key:"dueDatetime",value:function(e,t){return this.dueDatetimeControl.datetime(e,t)}},{key:"getID",value:function(){return $(this.element).attr("id")}},{key:"validate",value:function(){var e=this.startDatetimeControl.validate(),t=this.dueDatetimeControl.validate(),i=this.mustGradeField.validate(),n=this.mustBeGradedByField.validate();return e&&t&&i&&n}},{key:"validationErrors",value:function(){var e=[];return this.startDatetimeControl.validationErrors().length>0&&e.push("Peer assessment start is invalid"),this.dueDatetimeControl.validationErrors().length>0&&e.push("Peer assessment due is invalid"),this.mustGradeField.validationErrors().length>0&&e.push("Peer assessment must grade is invalid"),this.mustBeGradedByField.validationErrors().length>0&&e.push("Peer assessment must be graded by is invalid"),e}},{key:"clearValidationErrors",value:function(){this.startDatetimeControl.clearValidationErrors(),this.dueDatetimeControl.clearValidationErrors(),this.mustGradeField.clearValidationErrors(),this.mustBeGradedByField.clearValidationErrors()}}]),e}(),Y=function(){function e(t,i){R(this,e),this.element=t,this.scheduleElement=i,this.name="self-assessment",new m($("#include_self_assessment",this.element),[$("#self_assessment_settings_editor",this.element),$("#self_assessment_schedule_editor",this.scheduleElement)],[$("#self_assessment_description_closed",this.element)],new W([new U])).install(),this.startDatetimeControl=new p(this.scheduleElement,"#self_assessment_start_date","#self_assessment_start_time").install(),this.dueDatetimeControl=new p(this.scheduleElement,"#self_assessment_due_date","#self_assessment_due_time").install()}return G(e,[{key:"description",value:function(){return{start:this.startDatetime(),due:this.dueDatetime()}}},{key:"isEnabled",value:function(e){var t=$("#include_self_assessment",this.element);return c(t,e)}},{key:"toggleEnabled",value:function(){$("#include_self_assessment",this.element).click()}},{key:"startDatetime",value:function(e,t){return this.startDatetimeControl.datetime(e,t)}},{key:"dueDatetime",value:function(e,t){return this.dueDatetimeControl.datetime(e,t)}},{key:"getID",value:function(){return $(this.element).attr("id")}},{key:"validate",value:function(){var e=this.startDatetimeControl.validate(),t=this.dueDatetimeControl.validate();return e&&t}},{key:"validationErrors",value:function(){var e=[];return this.startDatetimeControl.validationErrors().length>0&&e.push("Self assessment start is invalid"),this.dueDatetimeControl.validationErrors().length>0&&e.push("Self assessment due is invalid"),e}},{key:"clearValidationErrors",value:function(){this.startDatetimeControl.clearValidationErrors(),this.dueDatetimeControl.clearValidationErrors()}}]),e}(),z=function(){function e(t){R(this,e),this.element=t,this.name="student-training",new m($("#include_student_training",this.element),[$("#student_training_settings_editor",this.element)],[],new W([new U])).install(),new V($("#student_training_settings_editor_show_details",this.element),$("#student_training_settings_editor_details",this.element)).install(),this.exampleContainer=new r(S,{containerElement:$("#openassessment_training_example_list",this.element).get(0),templateElement:$("#openassessment_training_example_template",this.element).get(0),addButtonElement:$(".openassessment_add_training_example",this.element).get(0),removeButtonClass:"openassessment_training_example_remove",containerItemClass:"openassessment_training_example"}),this.exampleContainer.addEventListeners()}return G(e,[{key:"description",value:function(){return{examples:this.exampleContainer.getItemValues()}}},{key:"isEnabled",value:function(e){var t=$("#include_student_training",this.element);return c(t,e)}},{key:"toggleEnabled",value:function(){$("#include_student_training",this.element).click()}},{key:"getID",value:function(){return $(this.element).attr("id")}},{key:"validate",value:function(){var e=!0;return $.each(this.exampleContainer.getAllItems(),(function(){e=this.validate()&&e})),e}},{key:"validationErrors",value:function(){var e=[];return $.each(this.exampleContainer.getAllItems(),(function(){e=e.concat(this.validationErrors())})),e}},{key:"clearValidationErrors",value:function(){$.each(this.exampleContainer.getAllItems(),(function(){this.clearValidationErrors()}))}},{key:"addTrainingExample",value:function(){this.exampleContainer.add()}}]),e}(),q=function(){function e(t){R(this,e),this.element=t,this.name="staff-assessment",new m($("#include_staff_assessment",this.element),[$("#staff_assessment_description",this.element)],[$("#staff_assessment_description",this.element)],new W([new U])).install()}return G(e,[{key:"description",value:function(){return{required:this.isEnabled()}}},{key:"isEnabled",value:function(e){var t=$("#include_staff_assessment",this.element);return c(t,e)}},{key:"toggleEnabled",value:function(){$("#include_staff_assessment",this.element).click()}},{key:"getID",value:function(){return $(this.element).attr("id")}},{key:"validate",value:function(){return!0}},{key:"validationErrors",value:function(){return[]}},{key:"clearValidationErrors",value:function(){}}]),e}();function X(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var K=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.assessmentsElement=$(t).siblings("#openassessment_assessment_module_settings_editors").get(0),this.assessmentViews=i,this.initializeSortableAssessments()}var t,i,n;return t=e,(i=[{key:"initializeSortableAssessments",value:function(){var e=this;$("#openassessment_assessment_module_settings_editors",e.element).sortable({start:function(t,i){$(".openassessment_assessment_module_editor",e.element).hide(),i.placeholder.height("auto"),i.helper.height("auto"),$("#openassessment_assessment_module_settings_editors",e.element).sortable("refresh").sortable("refreshPositions")},stop:function(){$(".openassessment_assessment_module_editor",e.element).show()},snap:!0,axis:"y",handle:".drag-handle",cursorAt:{top:20}}),$("#openassessment_assessment_module_settings_editors .drag-handle",e.element).disableSelection()}},{key:"isHidden",value:function(e){return e.hasClass("is--hidden")&&"true"===e.attr("aria-hidden")}},{key:"setHidden",value:function(e,t){e.toggleClass("is--hidden",t),e.attr("aria-hidden",t?"true":"false")}},{key:"assessmentsDescription",value:function(){var e=[],t=this;return $(".openassessment_assessment_module_settings_editor",this.assessmentsElement).each((function(){var i=t.assessmentViews[$(this).attr("id")],n=!t.isHidden($(i.element));if(i.isEnabled()&&n){var s=i.description();s.name=i.name,e.push(s)}})),e}},{key:"editorAssessmentsOrder",value:function(){var e=[],t=this;return $(".openassessment_assessment_module_settings_editor",this.assessmentsElement).each((function(){var i=t.assessmentViews[$(this).attr("id")];e.push(i.name)})),e}},{key:"validate",value:function(){var e=!0;return $.each(this.assessmentViews,(function(){this.isEnabled()&&(e=this.validate()&&e)})),e}},{key:"validationErrors",value:function(){var e=[];return $.each(this.assessmentViews,(function(){e=e.concat(this.validationErrors())})),e}},{key:"clearValidationErrors",value:function(){$.each(this.assessmentViews,(function(){this.clearValidationErrors()}))}}])&&X(t.prototype,i),n&&X(t,n),e}();function Q(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Z=function(){function e(t,i,n){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);this.settingsElement=t,this.assessmentViews=i,new f($("#openassessment_submission_file_upload_response",this.element),(function(e){var t=$("#openassessment_submission_file_upload_type_wrapper",s.element),i=$("#openassessment_submission_upload_selector",s.element).val();e?(t.removeClass("is--hidden"),onFileUploadTypeChanged(i)):t.addClass("is--hidden")}),new W([new U])).install(),new f($("#openassessment_submission_upload_selector",this.element),onFileUploadTypeChanged,new W([new U])).install(),this.teamsEnabledSelectControl=new f($("#openassessment_team_enabled_selector",this.element),onTeamsEnabledChange,new W([new U])).install(),this.leaderboardIntField=new h($("#openassessment_leaderboard_editor",this.element),{min:0,max:100}),this.fileTypeWhiteListInputField=new v($("#openassessment_submission_white_listed_file_types",this.element),(function(e){var t=[],i=[];if(!e)return i.push(gettext("File types can not be empty.")),i;var s=$.map(e.replace(/\./g,"").toLowerCase().split(","),$.trim);return $.each(s,(function(e,i){-1!==n.FILE_EXT_BLACK_LIST.indexOf(i)&&t.push(i)})),t.length&&i.push(gettext("The following file types are not allowed: ")+t.join(",")),i})),this.onTeamsEnabledChange($("#openassessment_team_enabled_selector").val())}var t,i,n;return t=e,(i=[{key:"onFileUploadTypeChanged",value:function(e){var t=$("#openassessment_submission_white_listed_file_types",this.element),i=$("#openassessment_submission_white_listed_file_types_wrapper .extension-warning",this.element);"custom"===e?(t.prop("disabled",!1),this.setHidden(i,!0)):("image"===e?t.val(data.ALLOWED_IMAGE_EXTENSIONS.join(", ")):"pdf-and-image"===e&&t.val(data.ALLOWED_FILE_EXTENSIONS.join(", ")),t.prop("disabled",!0),this.setHidden(i,!1))}},{key:"onTeamsEnabledChange",value:function(e){var t=$("#openassessment_teamset_selection_wrapper",this.element),i=$("#openassessment_submission_nfile_editor",this.element),n=this.assessmentViews.oa_self_assessment_editor,s=this.assessmentViews.oa_peer_assessment_editor,a=this.assessmentViews.oa_student_training_editor,r=this.assessmentViews.oa_staff_assessment_editor;e&&"0"!==e?(this.setHidden(t,!1),this.setHidden($(n.element),!0),this.setHidden($(s.element),!0),this.setHidden($(a.element),!0),this.setHidden($("#self_assessment_schedule_editor",n.scheduleElement),!0),this.setHidden($("#peer_assessment_schedule_editor",s.scheduleElement),!0),this.setHidden($("#openassessment_leaderboard_wrapper .disabled-label"),!1),this.setHidden($("#openassessment_leaderboard_wrapper .teams-warning"),!1),$("#openassessment_leaderboard_editor").prop("disabled",!0),r.isEnabled(!0),i.prop("disblaed",!0),i.val(1)):(this.setHidden(t,!0),this.setHidden($(n.element),!1),this.setHidden($(s.element),!1),this.setHidden($(a.element),!1),n.isEnabled()&&this.setHidden($("#self_assessment_schedule_editor",n.scheduleElement),!1),s.isEnabled()&&this.setHidden($("#peer_assessment_schedule_editor",s.scheduleElement),!1),this.setHidden($("#openassessment_leaderboard_wrapper .disabled-label"),!0),this.setHidden($("#openassessment_leaderboard_wrapper .teams-warning"),!0),$("#openassessment_leaderboard_editor").prop("disabled",!1),i.prop("disabled",!1))}},{key:"displayName",value:function(e){var t=$("#openassessment_title_editor",this.settingsElement);return d(t,e)}},{key:"textResponseNecessity",value:function(e){var t=$("#openassessment_submission_text_response",this.settingsElement);return void 0!==e&&t.val(e),t.val()}},{key:"fileUploadResponseNecessity",value:function(e,t){var i=$("#openassessment_submission_file_upload_response",this.settingsElement);return void 0!==e&&(t=t||!1,i.val(e),t&&$(i).trigger("change")),i.val()}},{key:"fileUploadType",value:function(e){var t=$("#openassessment_submission_file_upload_type_wrapper",this.settingsElement);if(!$(t).hasClass("is--hidden")){var i=$("#openassessment_submission_upload_selector",this.settingsElement);return void 0!==e&&(i.val(e),$(i).trigger("change")),i.val()}return""}},{key:"fileTypeWhiteList",value:function(e){return void 0!==e&&this.fileTypeWhiteListInputField.set(e),this.fileTypeWhiteListInputField.get()}},{key:"settingSelectorEnabled",value:function(e,t){var i=$(e,this.settingsElement);return void 0!==t&&(t?i.val(1):i.val(0)),"1"===i.val()}},{key:"multipleFilesEnabled",value:function(e){return this.settingSelectorEnabled("#openassessment_submission_nfile_editor",e)}},{key:"latexEnabled",value:function(e){return this.settingSelectorEnabled("#openassessment_submission_latex_editor",e)}},{key:"teamsEnabled",value:function(e){return void 0!==e&&this.teamsEnabledSelectControl.change(e?"1":"0"),this.settingSelectorEnabled("#openassessment_team_enabled_selector",e)}},{key:"isHidden",value:function(e){return e.hasClass("is--hidden")&&"true"===e.attr("aria-hidden")}},{key:"setHidden",value:function(e,t){e.toggleClass("is--hidden",t),e.attr("aria-hidden",t?"true":"false")}},{key:"teamset",value:function(e){if(this.teamsEnabled()){var t=$("#openassessment_teamset_selector",this.settingsElement);return void 0!==e&&t.val(e),t.val()}return""}},{key:"leaderboardNum",value:function(e){return void 0!==e&&this.leaderboardIntField.set(e),this.leaderboardIntField.get(e)}},{key:"validate",value:function(){var e=!0;return e=this.leaderboardIntField.validate()&&e,"custom"===this.fileUploadType()?e=this.fileTypeWhiteListInputField.validate()&&e:this.fileTypeWhiteListInputField.get()&&!this.fileTypeWhiteListInputField.validate()&&this.fileTypeWhiteListInputField.set(""),e}},{key:"validationErrors",value:function(){var e=[];return this.leaderboardIntField.validationErrors().length>0&&e.push("Leaderboard number is invalid"),this.fileTypeWhiteListInputField.validationErrors().length>0&&(e=e.concat(this.fileTypeWhiteListInputField.validationErrors())),e}},{key:"clearValidationErrors",value:function(){this.leaderboardIntField.clearValidationErrors(),this.fileTypeWhiteListInputField.clearValidationErrors()}}])&&Q(t.prototype,i),n&&Q(t,n),e}(),ee=i(1);function te(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ie=function(){function e(t,i,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=i,this.runtime=t,this.server=n,this.data=a,this.fixModalHeight(),this.initializeTabs(),this.alert=(new s).install();var r=new B;this.promptsView=new O($("#oa_prompts_editor_wrapper",this.element).get(0),new W([r])),this.rubricView=new A($("#oa_rubric_editor_wrapper",this.element).get(0),new W([r])),this.scheduleView=new P($("#oa_schedule_editor_wrapper",this.element).get(0));var o=new q($("#oa_staff_assessment_editor",this.element).get(0)),l=new z($("#oa_student_training_editor",this.element).get(0)),u=new J($("#oa_peer_assessment_editor",this.element).get(0),$("#oa_schedule_editor_wrapper",this.element).get(0)),d=new Y($("#oa_self_assessment_editor",this.element).get(0),$("#oa_schedule_editor_wrapper",this.element).get(0)),c={};c[o.getID()]=o,c[l.getID()]=l,c[u.getID()]=u,c[d.getID()]=d,this.assessmentsStepsView=new K($("#oa_assessment_steps_editor_wrapper",this.element).get(0),c),this.settingsView=new Z($("#oa_basic_settings_editor",this.element).get(0),c,a),$(".openassessment_save_button",this.element).click($.proxy(this.save,this)),$(".openassessment_cancel_button",this.element).click($.proxy(this.cancel,this))}var t,i,n;return t=e,(i=[{key:"fixModalHeight",value:function(){$(this.element).addClass("openassessment_full_height").parentsUntil(".modal-window").addClass("openassessment_full_height"),$(this.element).closest(".modal-window").addClass("openassessment_modal_window")}},{key:"initializeTabs",value:function(){void 0===this.lastOpenEditingTab&&(this.lastOpenEditingTab=0),$(".openassessment_editor_content_and_tabs",this.element).tabs({active:this.lastOpenEditingTab})}},{key:"saveTabState",value:function(){var e=$(".openassessment_editor_content_and_tabs",this.element);this.lastOpenEditingTab=e.tabs("option","active")}},{key:"save",value:function(){var e=this;this.saveTabState(),this.clearValidationErrors(),this.validate()?(this.alert.hide(),this.server.checkReleased().done((function(t){t?e.confirmPostReleaseUpdate($.proxy(e.updateEditorContext,e)):e.updateEditorContext()})).fail((function(t){e.showError(t)}))):this.alert.setMessage(gettext("Couldn't Save This Assignment"),gettext("Please correct the outlined fields.")).show()}},{key:"confirmPostReleaseUpdate",value:function(e){var t=gettext("This problem has already been released. Any changes will apply only to future assessments.");window.confirm(t)&&e()}},{key:"updateEditorContext",value:function(){var e=this;this.runtime.notify("save",{state:"start"});var t=view.settingsView.fileUploadType(),i=view.settingsView.teamsEnabled();this.server.updateEditorContext({prompts:view.promptsView.promptsDefinition(),prompts_type:view.promptsView.promptsType(),feedbackPrompt:view.rubricView.feedbackPrompt(),feedback_default_text:view.rubricView.feedback_default_text(),criteria:view.rubricView.criteriaDefinition(),title:view.settingsView.displayName(),submissionStart:view.scheduleView.submissionStart(),submissionDue:view.scheduleView.submissionDue(),assessments:view.assessmentsStepsView.assessmentsDescription(),textResponse:view.settingsView.textResponseNecessity(),fileUploadResponse:view.settingsView.fileUploadResponseNecessity(),fileUploadType:""!==t?t:null,fileTypeWhiteList:view.settingsView.fileTypeWhiteList(),multipleFilesEnabled:!!i||view.settingsView.multipleFilesEnabled(),latexEnabled:view.settingsView.latexEnabled(),leaderboardNum:view.settingsView.leaderboardNum(),editorAssessmentsOrder:view.assessmentsStepsView.editorAssessmentsOrder(),teamsEnabled:i,selectedTeamsetId:view.settingsView.teamset()}).done((function(){return e.runtime.notify("save",{state:"end"})})).fail((function(t){return e.showError(t)}))}},{key:"cancel",value:function(){this.saveTabState(),this.runtime.notify("cancel",{})}},{key:"showError",value:function(e){this.runtime.notify("error",{msg:e})}},{key:"validate",value:function(){var e=this.settingsView.validate(),t=this.assessmentsStepsView.validate(),i=this.scheduleView.validate(),n=this.rubricView.validate(),s=this.promptsView.validate();return e&&t&&i&&n&&s}},{key:"validationErrors",value:function(){return this.settingsView.validationErrors().concat(this.assessmentsStepsView.validationErrors().concat(this.scheduleView.validationErrors().concat(this.rubricView.validationErrors().concat(this.promptsView.validationErrors()))))}},{key:"clearValidationErrors",value:function(){this.settingsView.clearValidationErrors(),this.assessmentsStepsView.clearValidationErrors(),this.scheduleView.clearValidationErrors(),this.rubricView.clearValidationErrors(),this.promptsView.clearValidationErrors()}}])&&te(t.prototype,i),n&&te(t,n),e}();window.OpenAssessmentEditor=function(e,t,i){var n=new ee.a(e,t);new ie(e,t,n,i)}},2:function(e,t){void 0===window.gettext&&(window.gettext=function(e){return e}),void 0===window.ngetgext&&(window.ngettext=function(e,t,i){return i>1?t:e}),void 0===window.Logger&&(window.Logger={log:function(){}}),void 0===window.MathJax&&(window.MathJax={Hub:{Typeset:function(){},Queue:function(){}}})}});
//# sourceMappingURL=openassessment-studio.js.map