!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){void 0===window.gettext&&(window.gettext=function(e){return e}),void 0===window.ngetgext&&(window.ngettext=function(e,t,n){return n>1?t:e}),void 0===window.Logger&&(window.Logger={log:function(){}}),void 0===window.MathJax&&(window.MathJax={Hub:{Typeset:function(){},Queue:function(){}}})},function(e,t,n){"use strict";n.r(t);n(0);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=$("#openassessment_validation_alert"),this.editorElement=$(this.element).parent(),this.title=$(".openassessment_alert_title",this.element),this.message=$(".openassessment_alert_message",this.element),this.closeButton=$(".openassessment_alert_close",this.element),this.ALERT_YELLOW="rgb(192, 172, 0)",this.DARK_GREY="#323232"}var t,n,s;return t=e,(n=[{key:"install",value:function(){var e=this;return this.closeButton.click((function(t){t.preventDefault(),e.hide()})),this}},{key:"hide",value:function(){var e=$("#openassessment_editor_header",this.editorElement).outerHeight();this.element.addClass("covered");var t={height:"Calc(100% - "+e+"px)","border-top-right-radius":"3px","border-top-left-radius":"3px"};return $(".oa_editor_content_wrapper",this.editorElement).each((function(){$(this).css(t)})),this}},{key:"show",value:function(){var e=this;if(this.isVisible())$(this.element).animate({"background-color":e.ALERT_YELLOW},300,"swing",(function(){$(this).animate({"background-color":e.DARK_GREY},700,"swing")}));else{this.element.removeClass("covered");var t=this.element.outerHeight(),n=$("#openassessment_editor_header",this.editorElement).outerHeight(),i={height:"Calc(100% - "+(t+n)+"px)","border-top-right-radius":"0px","border-top-left-radius":"0px"};$(".oa_editor_content_wrapper",this.editorElement).each((function(){$(this).css(i),$(this).scrollTop($(this).scrollTop()+t)}))}return this}},{key:"setMessage",value:function(e,t){return this.title.text(e),this.message.text(t),this}},{key:"isVisible",value:function(){return!this.element.hasClass("covered")}},{key:"getTitle",value:function(){return this.title.text()}},{key:"getMessage",value:function(){return this.message.text()}}])&&i(t.prototype,n),s&&i(t,s),e}();function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.containerElement=n.containerElement,this.templateElement=n.templateElement,this.addButtonElement=n.addButtonElement,this.removeButtonClass=n.removeButtonClass,this.containerItemClass=n.containerItemClass,this.notifier=n.notifier,this.addRemoveEnabled=void 0===n.addRemoveEnabled||n.addRemoveEnabled;var i=this;this.createContainerItem=function(e){return new t(e,i.notifier)}}var t,n,i;return t=e,(n=[{key:"addEventListeners",value:function(){var e=this;this.addRemoveEnabled?($(this.addButtonElement).click($.proxy(this.add,this)),$("."+this.removeButtonClass,this.containerElement).click((function(t){var n=e.createContainerItem(t.target);e.remove(n)}))):($(this.addButtonElement).addClass("is--disabled"),$("."+this.removeButtonClass,this.containerElement).addClass("is--disabled")),$("."+this.containerItemClass,this.containerElement).each((function(t,n){e.createContainerItem(n).addEventListeners()}))}},{key:"add",value:function(){$(this.templateElement).children().first().clone().removeAttr("id").toggleClass("is--hidden",!1).toggleClass(this.containerItemClass,!0).appendTo($(this.containerElement));var e=this,t=$("."+this.containerItemClass,this.containerElement).last();this.addRemoveEnabled?t.find("."+this.removeButtonClass).click((function(t){var n=e.createContainerItem(t.target);e.remove(n)})):t.find("."+this.removeButtonClass).addClass("is--disabled");var n=e.createContainerItem(t);n.addEventListeners(),n.addHandler()}},{key:"remove",value:function(e){var t=$(e.element).closest("."+this.containerItemClass);this.createContainerItem(t).removeHandler(),t.remove()}},{key:"getItemValues",value:function(){var e=[],t=this;return $("."+this.containerItemClass,this.containerElement).each((function(n,i){var s=t.createContainerItem(i).getFieldValues();e.push(s)})),e}},{key:"getItem",value:function(e){var t=$("."+this.containerItemClass,this.containerElement).get(e);return void 0!==t?this.createContainerItem(t):null}},{key:"getAllItems",value:function(){var e=this;return $("."+this.containerItemClass,this.containerElement).map((function(){return e.createContainerItem(this)}))}}])&&a(t.prototype,n),i&&a(t,i),e}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}var d=function(e,t){return void 0!==t&&e.val(t),e.val()},c=function(e,t){return void 0!==t&&e.prop("checked",t),e.prop("checked")},h=function(){function e(t,n){o(this,e),this.max=n.max,this.min=n.min,this.input=$(t)}return u(e,[{key:"get",value:function(){return parseInt(this.input.val().trim(),10)}},{key:"set",value:function(e){this.input.val(e)}},{key:"validate",value:function(){var e=this.get(),t=!isNaN(e)&&e>=this.min&&e<=this.max;return-1!==this.input.val().indexOf(".")&&(t=!1),t||this.input.addClass("openassessment_highlighted_field"),t}},{key:"clearValidationErrors",value:function(){this.input.removeClass("openassessment_highlighted_field")}},{key:"validationErrors",value:function(){return this.input.hasClass("openassessment_highlighted_field")?["Int field is invalid"]:[]}}]),e}(),m=function(){function e(t,n,i,s){o(this,e),this.checkbox=t,this.shownSections=n,this.hiddenSections=i,this.notifier=s}return u(e,[{key:"install",value:function(){return this.checkbox.change(this,(function(e){var t=e.data;this.checked?(t.notifier.notificationFired("toggleOn",{}),t.show()):(t.notifier.notificationFired("toggleOff",{}),t.hide())})),this}},{key:"show",value:function(){$.each(this.hiddenSections,(function(e,t){t.addClass("is--hidden")})),$.each(this.shownSections,(function(e,t){t.removeClass("is--hidden")}))}},{key:"hide",value:function(){$.each(this.shownSections,(function(e,t){t.addClass("is--hidden")})),$.each(this.hiddenSections,(function(e,t){t.removeClass("is--hidden")}))}}]),e}(),f=function(){function e(t,n,i){o(this,e),this.element=t,this.datePicker=n,this.timePicker=i}return u(e,[{key:"install",value:function(){var e=$(this.datePicker,this.element).val();return $(this.datePicker,this.element).datepicker({showButtonPanel:!0}).datepicker("option","dateFormat","yy-mm-dd").datepicker("setDate",e),$(this.timePicker,this.element).timepicker({timeFormat:"H:i",step:60}),this}},{key:"datetime",value:function(e,t){var n=$(this.datePicker,this.element),i=$(this.timePicker,this.element);return void 0!==e&&n.val(e),void 0!==t&&i.val(t),n.val()+"T"+i.val()}},{key:"validate",value:function(){var e=$(this.datePicker,this.element).val(),t=$(this.timePicker,this.element).val(),n=!1;try{n=$.datepicker.parseDate($.datepicker.ISO_8601,e)instanceof Date}catch(e){}n||$(this.datePicker,this.element).addClass("openassessment_highlighted_field");var i=null!==t.match(/^\d{2}:\d{2}$/g);return i||$(this.timePicker,this.element).addClass("openassessment_highlighted_field"),n&&i}},{key:"clearValidationErrors",value:function(){$(this.datePicker,this.element).removeClass("openassessment_highlighted_field"),$(this.timePicker,this.element).removeClass("openassessment_highlighted_field")}},{key:"validationErrors",value:function(){var e=[],t=$(this.datePicker,this.element).hasClass("openassessment_highlighted_field"),n=$(this.timePicker,this.element).hasClass("openassessment_highlighted_field");return t&&e.push("Date is invalid"),n&&e.push("Time is invalid"),e}}]),e}(),p=function(){function e(t,n,i){o(this,e),this.select=t,this.mapping=n,this.notifier=i}return u(e,[{key:"install",value:function(){return this.select.change(this,(function(e){var t=e.data;t.notifier.notificationFired("selectionChanged",{selected:this.value}),t.change(this.value)})),this}},{key:"change",value:function(e){$.isFunction(this.mapping)?this.mapping(e):$.each(this.mapping,(function(t,n){t===e?n.removeClass("is--hidden"):n.addClass("is--hidden")}))}}]),e}(),v=function(){function e(t,n){o(this,e),this.input=$(t),this.validator=n,this.errors=[]}return u(e,[{key:"get",value:function(){return this.input.val()}},{key:"set",value:function(e){this.input.val(e)}},{key:"validate",value:function(){return this.errors=this.validator(this.get()),this.errors.length&&(this.input.addClass("openassessment_highlighted_field"),this.input.parent().nextAll(".message-status").text(this.errors.join(";")),this.input.parent().nextAll(".message-status").addClass("is-shown")),0===this.errors.length}},{key:"clearValidationErrors",value:function(){this.input.removeClass("openassessment_highlighted_field"),this.input.parent().nextAll(".message-status").removeClass("is-shown")}},{key:"validationErrors",value:function(){return this.errors}}]),e}();function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function b(e,t,n){return t&&y(e.prototype,t),n&&y(e,n),e}var k=function(e,t){for(var n=0;n<=e.length;){if(0===e.parent().find("*["+t+"='"+n+"']").length)return n.toString();n++}return n.toString()},w=function(e){var t=$(e).attr("data-points"),n=$(e).attr("data-label"),i=$(e).val();""===n&&(n=gettext("Unnamed Option"));var s=n+" - "+t+" point",a=n+" - "+t+" points",r="";r=""===i?gettext("Not Selected"):isNaN(t)?n:ngettext(s,a,t),$(e).text(r)},E=function(){function e(t,n){g(this,e),this.tinyMCEEnabled&&(t=this.attachWysiwygToPrompt(t)),this.element=t,this.notifier=n}return b(e,[{key:"attachWysiwygToPrompt",value:function(e){if(!$(e).find("textarea").attr("id")){var t=$(e).find("textarea"),n=$(t).val(),i=$(t).data("type");n&&"text"===i&&(n=_.escape(n).replace(/(?:\r\n|\r|\n)/g,"<br />"),$(t).val(n));var s=Date.now()+"-textarea-"+100*Math.random();$(t).attr("id",s).tinymce(oaTinyMCE({base_asset_url:$("#openassessment_prompt_template").data("baseAssetUrl")}))}return $(e)}},{key:"getFieldValues",value:function(){return{description:this.description()}}},{key:"description",value:function(e){var t=$(".openassessment_prompt_description",this.element);if(!this.tinyMCEEnabled)return d(t,e);var n=window.tinyMCE.get(t.attr("id"));if(!e)return n.getContent();n.setContent(e)}},{key:"addEventListeners",value:function(){}},{key:"addHandler",value:function(){this.notifier.notificationFired("promptAdd",{index:this.element.index()})}},{key:"removeHandler",value:function(){this.notifier.notificationFired("promptRemove",{index:this.element.index()})}},{key:"updateHandler",value:function(){}},{key:"validate",value:function(){return!0}},{key:"validationErrors",value:function(){return[]}},{key:"clearValidationErrors",value:function(){}},{key:"tinyMCEEnabled",get:function(){return void 0!==window.tinyMCE}}]),e}(),C=function(){function e(t,n){g(this,e),this.element=t,this.notifier=n,this.pointsField=new h($(".openassessment_criterion_option_points",this.element),{min:0,max:999})}return b(e,[{key:"addEventListeners",value:function(){$(this.element).focusout($.proxy(this.updateHandler,this))}},{key:"getFieldValues",value:function(){var e={label:this.label(),points:this.points(),explanation:this.explanation()},t=OpenAssessment.Fields.stringField($(".openassessment_criterion_option_name",this.element));return""!==t&&(e.name=t),e}},{key:"label",value:function(e){var t=$(".openassessment_criterion_option_label",this.element);return OpenAssessment.Fields.stringField(t,e)}},{key:"points",value:function(e){return void 0!==e&&this.pointsField.set(e),this.pointsField.get()}},{key:"explanation",value:function(e){var t=$(".openassessment_criterion_option_explanation",this.element);return OpenAssessment.Fields.stringField(t,e)}},{key:"addHandler",value:function(){var e=$(this.element).closest(".openassessment_criterion"),t=$(e).data("criterion"),n=$(".openassessment_criterion_label",e).val(),i=$(".openassessment_criterion_option",this.element.parent()),s=OpenAssessment.ItemUtilities.createUniqueName(i,"data-option");$(this.element).attr("data-criterion",t).attr("data-option",s),$(".openassessment_criterion_option_name",this.element).attr("value",s);var a=this.getFieldValues();this.notifier.notificationFired("optionAdd",{criterionName:t,criterionLabel:n,name:s,label:a.label,points:a.points})}},{key:"removeHandler",value:function(){var e=$(this.element).data("criterion"),t=$(this.element).data("option");this.notifier.notificationFired("optionRemove",{criterionName:e,name:t})}},{key:"updateHandler",value:function(){var e=this.getFieldValues(),t=$(this.element).data("criterion"),n=$(this.element).data("option"),i=e.label,s=e.points;this.notifier.notificationFired("optionUpdated",{criterionName:t,name:n,label:i,points:s})}},{key:"validate",value:function(){return this.pointsField.validate()}},{key:"validationErrors",value:function(){return this.pointsField.validationErrors().length>0?["Option points are invalid"]:[]}},{key:"clearValidationErrors",value:function(){this.pointsField.clearValidationErrors()}}]),e}(),x=function(){function e(t,n){g(this,e),this.element=t,this.notifier=n,this.labelSel=$(".openassessment_criterion_label",this.element),this.promptSel=$(".openassessment_criterion_prompt",this.element),this.optionContainer=new r(C,{containerElement:$(".openassessment_criterion_option_list",this.element).get(0),templateElement:$("#openassessment_option_template").get(0),addButtonElement:$(".openassessment_criterion_add_option",this.element).get(0),removeButtonClass:"openassessment_criterion_option_remove_button",containerItemClass:"openassessment_criterion_option",notifier:this.notifier})}return b(e,[{key:"addEventListeners",value:function(){this.optionContainer.addEventListeners(),$(this.element).focusout($.proxy(this.updateHandler,this))}},{key:"getFieldValues",value:function(){var e={label:this.label(),prompt:this.prompt(),feedback:this.feedback(),options:this.optionContainer.getItemValues()},t=d($(".openassessment_criterion_name",this.element));return""!==t&&(e.name=t),e}},{key:"label",value:function(e){return d(this.labelSel,e)}},{key:"prompt",value:function(e){return d(this.promptSel,e)}},{key:"feedback",value:function(){return $(".openassessment_criterion_feedback",this.element).val()}},{key:"addOption",value:function(){this.optionContainer.add()}},{key:"addHandler",value:function(){var e=$(".openassessment_criterion",this.element.parent()),t=k(e,"data-criterion");$(this.element).attr("data-criterion",t),$(".openassessment_criterion_name",this.element).attr("value",t)}},{key:"removeHandler",value:function(){var e=$(this.element).data("criterion");this.notifier.notificationFired("criterionRemove",{criterionName:e})}},{key:"updateHandler",value:function(){var e=this.getFieldValues(),t=e.name,n=e.label;this.notifier.notificationFired("criterionUpdated",{criterionName:t,criterionLabel:n})}},{key:"validate",value:function(){var e=""!==this.prompt();return e||this.promptSel.addClass("openassessment_highlighted_field"),$.each(this.optionContainer.getAllItems(),(function(){e=this.validate()&&e})),e}},{key:"validationErrors",value:function(){var e=[];return this.promptSel.hasClass("openassessment_highlighted_field")&&e.push("Criterion prompt is invalid."),$.each(this.optionContainer.getAllItems(),(function(){e=e.concat(this.validationErrors())})),e}},{key:"clearValidationErrors",value:function(){this.promptSel.removeClass("openassessment_highlighted_field"),$.each(this.optionContainer.getAllItems(),(function(){this.clearValidationErrors()}))}}]),e}(),T=function(){function e(t){g(this,e),this.element=t,this.criteria=$(".openassessment_training_example_criterion_option",this.element),this.answer=$(".openassessment_training_example_essay_part textarea",this.element)}return b(e,[{key:"getFieldValues",value:function(){var e=this.criteria.map((function(){return{criterion:$(this).data("criterion"),option:$(this).prop("value")}})).get();return{answer:this.answer.map((function(){return $(this).prop("value")})).get(),options_selected:e}}},{key:"addHandler",value:function(){$(".openassessment_training_example_criterion_option",this.element).each((function(){$("option",this).each((function(){w($(this))}))}))}},{key:"addEventListeners",value:function(){}},{key:"removeHandler",value:function(){}},{key:"updateHandler",value:function(){}},{key:"validate",value:function(){var e=!0;return this.criteria.each((function(){var t=""!==$(this).prop("value");e=t&&e,t||$(this).addClass("openassessment_highlighted_field")})),e}},{key:"validationErrors",value:function(){var e=[];return this.criteria.each((function(){$(this).hasClass("openassessment_highlighted_field")&&e.push("Student training example is invalid.")})),e}},{key:"clearValidationErrors",value:function(){this.criteria.each((function(){$(this).removeClass("openassessment_highlighted_field")}))}}]),e}(),V=function(){function e(t,n){g(this,e),this.controlElement=t,this.hiddenElement=n}return b(e,[{key:"install",value:function(){var e=this;return this.controlElement.click((function(t){t.preventDefault(),e.showHiddenElement(),e.hideSelf()})),this}},{key:"showHiddenElement",value:function(){this.hiddenElement.removeClass("is--hidden")}},{key:"hideSelf",value:function(){this.controlElement.addClass("is--hidden")}}]),e}();function S(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var O=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.editorElement=$(this.element).closest("#openassessment-editor"),this.addRemoveEnabled="true"!==this.editorElement.attr("data-is-released"),this.promptsContainer=new r(E,{containerElement:$("#openassessment_prompts_list",this.element).get(0),templateElement:$("#openassessment_prompt_template",this.element).get(0),addButtonElement:$("#openassessment_prompts_add_prompt",this.element).get(0),removeButtonClass:"openassessment_prompt_remove_button",containerItemClass:"openassessment_prompt",notifier:n,addRemoveEnabled:this.addRemoveEnabled}),this.promptsContainer.addEventListeners()}var t,n,i;return t=e,(n=[{key:"promptsDefinition",value:function(){return this.promptsContainer.getItemValues()}},{key:"promptsType",value:function(){var e=this.promptsContainer.getItem(0);return e&&e.tinyMCEEnabled?"html":"text"}},{key:"addPrompt",value:function(){this.addRemoveEnabled&&this.promptsContainer.add()}},{key:"removePrompt",value:function(e){this.addRemoveEnabled&&this.promptsContainer.remove(e)}},{key:"getAllPrompts",value:function(){return this.promptsContainer.getAllItems()}},{key:"getPromptItem",value:function(e){return this.promptsContainer.getItem(e)}},{key:"validate",value:function(){return!0}},{key:"validationErrors",value:function(){return[]}},{key:"clearValidationErrors",value:function(){}}])&&S(t.prototype,n),i&&S(t,i),e}();function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var I=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.criterionAddButton=$("#openassessment_rubric_add_criterion",this.element),this.criteriaContainer=new r(x,{containerElement:$("#openassessment_criterion_list",this.element).get(0),templateElement:$("#openassessment_criterion_template",this.element).get(0),addButtonElement:$("#openassessment_rubric_add_criterion",this.element).get(0),removeButtonClass:"openassessment_criterion_remove_button",containerItemClass:"openassessment_criterion",notifier:n}),this.criteriaContainer.addEventListeners()}var t,n,i;return t=e,(n=[{key:"criteriaDefinition",value:function(){for(var e=this.criteriaContainer.getItemValues(),t=0;t<e.length;t++){var n=e[t];n.order_num=t;for(var i=0;i<n.options.length;i++)n.options[i].order_num=i}return e}},{key:"feedbackPrompt",value:function(e){var t=$("#openassessment_rubric_feedback",this.element);return d(t,e)}},{key:"feedback_default_text",value:function(e){var t=$("#openassessment_rubric_feedback_default_text",this.element);return d(t,e)}},{key:"addCriterion",value:function(){this.criteriaContainer.add()}},{key:"removeCriterion",value:function(e){this.criteriaContainer.remove(e)}},{key:"getAllCriteria",value:function(){return this.criteriaContainer.getAllItems()}},{key:"getCriterionItem",value:function(e){return this.criteriaContainer.getItem(e)}},{key:"addOption",value:function(e){this.getCriterionItem(e).optionContainer.add()}},{key:"removeOption",value:function(e,t){this.getCriterionItem(e).optionContainer.remove(t)}},{key:"getAllOptions",value:function(e){return this.getCriterionItem(e).optionContainer.getAllItems()}},{key:"getOptionItem",value:function(e,t){return this.getCriterionItem(e).optionContainer.getItem(t)}},{key:"validate",value:function(){var e=this.getAllCriteria(),t=e.length>0;return t||this.criterionAddButton.addClass("openassessment_highlighted_field").click((function(){$(this).removeClass("openassessment_highlighted_field")})),$.each(e,(function(){t=this.validate()&&t})),t}},{key:"validationErrors",value:function(){var e=[];return this.criterionAddButton.hasClass("openassessment_highlighted_field")&&e.push("The rubric must contain at least one criterion"),$.each(this.getAllCriteria(),(function(){e=e.concat(this.validationErrors())})),e}},{key:"clearValidationErrors",value:function(){this.criterionAddButton.removeClass("openassessment_highlighted_field"),$.each(this.getAllCriteria(),(function(){this.clearValidationErrors()}))}}])&&j(t.prototype,n),i&&j(t,i),e}();function D(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var P=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.startDatetimeControl=new f(this.element,"#openassessment_submission_start_date","#openassessment_submission_start_time").install(),this.dueDatetimeControl=new f(this.element,"#openassessment_submission_due_date","#openassessment_submission_due_time").install()}var t,n,i;return t=e,(n=[{key:"submissionStart",value:function(e,t){return this.startDatetimeControl.datetime(e,t)}},{key:"submissionDue",value:function(e,t){return this.dueDatetimeControl.datetime(e,t)}},{key:"validate",value:function(){var e=!0;return e=this.startDatetimeControl.validate()&&e,e=this.dueDatetimeControl.validate()&&e}},{key:"validationErrors",value:function(){var e=[];return this.startDatetimeControl.validationErrors().length>0&&e.push("Submission start is invalid"),this.dueDatetimeControl.validationErrors().length>0&&e.push("Submission due is invalid"),e}},{key:"clearValidationErrors",value:function(){this.startDatetimeControl.clearValidationErrors(),this.dueDatetimeControl.clearValidationErrors()}}])&&D(t.prototype,n),i&&D(t,i),e}();function W(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var F=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners=t}var t,n,i;return t=e,(n=[{key:"notificationFired",value:function(e,t){for(var n=0;n<this.listeners.length;n++)"function"==typeof this.listeners[n][e]&&this.listeners[n][e](t)}}])&&W(t.prototype,n),i&&W(t,i),e}();function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function B(e,t,n){return t&&H(e.prototype,t),n&&H(e,n),e}var L=function(){function e(){A(this,e),this.alert=new OpenAssessment.ValidationAlert}return B(e,[{key:"toggleOff",value:function(){this.alert.setMessage(gettext("Warning"),gettext("Changes to steps that are not selected as part of the assignment will not be saved.")).show()}},{key:"toggleOn",value:function(){this.alert.hide()}}]),e}();function N(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function U(e,t,n){return t&&R(e.prototype,t),n&&R(e,n),e}var M=function(){function e(t,n){N(this,e),this.element=t,this.name="peer-assessment",this.scheduleElement=n,this.mustGradeField=new h($("#peer_assessment_must_grade",this.element),{min:0,max:99}),this.mustBeGradedByField=new h($("#peer_assessment_graded_by",this.element),{min:0,max:99}),new m($("#include_peer_assessment",this.element),[$("#peer_assessment_settings_editor",this.element),$("#peer_assessment_schedule_editor",this.scheduleElement)],[],new F([new L])).install(),new V($("#peer_assessment_settings_editor_show_details",this.element),$("#peer_assessment_settings_editor_details",this.element)).install(),this.startDatetimeControl=new f(this.scheduleElement,"#peer_assessment_start_date","#peer_assessment_start_time").install(),this.dueDatetimeControl=new f(this.scheduleElement,"#peer_assessment_due_date","#peer_assessment_due_time").install()}return U(e,[{key:"description",value:function(){return{must_grade:this.mustGradeNum(),must_be_graded_by:this.mustBeGradedByNum(),start:this.startDatetime(),due:this.dueDatetime()}}},{key:"isEnabled",value:function(e){var t=$("#include_peer_assessment",this.element);return c(t,e)}},{key:"toggleEnabled",value:function(){$("#include_peer_assessment",this.element).click()}},{key:"mustGradeNum",value:function(e){return void 0!==e&&this.mustGradeField.set(e),this.mustGradeField.get()}},{key:"mustBeGradedByNum",value:function(e){return void 0!==e&&this.mustBeGradedByField.set(e),this.mustBeGradedByField.get()}},{key:"startDatetime",value:function(e,t){return this.startDatetimeControl.datetime(e,t)}},{key:"dueDatetime",value:function(e,t){return this.dueDatetimeControl.datetime(e,t)}},{key:"getID",value:function(){return $(this.element).attr("id")}},{key:"validate",value:function(){var e=this.startDatetimeControl.validate(),t=this.dueDatetimeControl.validate(),n=this.mustGradeField.validate(),i=this.mustBeGradedByField.validate();return e&&t&&n&&i}},{key:"validationErrors",value:function(){var e=[];return this.startDatetimeControl.validationErrors().length>0&&e.push("Peer assessment start is invalid"),this.dueDatetimeControl.validationErrors().length>0&&e.push("Peer assessment due is invalid"),this.mustGradeField.validationErrors().length>0&&e.push("Peer assessment must grade is invalid"),this.mustBeGradedByField.validationErrors().length>0&&e.push("Peer assessment must be graded by is invalid"),e}},{key:"clearValidationErrors",value:function(){this.startDatetimeControl.clearValidationErrors(),this.dueDatetimeControl.clearValidationErrors(),this.mustGradeField.clearValidationErrors(),this.mustBeGradedByField.clearValidationErrors()}}]),e}(),G=function(){function e(t){N(this,e),this.element=t,this.name="student-training",new m($("#include_student_training",this.element),[$("#student_training_settings_editor",this.element)],[],new F([new L])).install(),new V($("#student_training_settings_editor_show_details",this.element),$("#student_training_settings_editor_details",this.element)).install(),this.exampleContainer=new r(T,{containerElement:$("#openassessment_training_example_list",this.element).get(0),templateElement:$("#openassessment_training_example_template",this.element).get(0),addButtonElement:$(".openassessment_add_training_example",this.element).get(0),removeButtonClass:"openassessment_training_example_remove",containerItemClass:"openassessment_training_example"}),this.exampleContainer.addEventListeners()}return U(e,[{key:"description",value:function(){return{examples:this.exampleContainer.getItemValues()}}},{key:"isEnabled",value:function(e){var t=$("#include_student_training",this.element);return c(t,e)}},{key:"toggleEnabled",value:function(){$("#include_student_training",this.element).click()}},{key:"getID",value:function(){return $(this.element).attr("id")}},{key:"validate",value:function(){var e=!0;return $.each(this.exampleContainer.getAllItems(),(function(){e=this.validate()&&e})),e}},{key:"validationErrors",value:function(){var e=[];return $.each(this.exampleContainer.getAllItems(),(function(){e=e.concat(this.validationErrors())})),e}},{key:"clearValidationErrors",value:function(){$.each(this.exampleContainer.getAllItems(),(function(){this.clearValidationErrors()}))}},{key:"addTrainingExample",value:function(){this.exampleContainer.add()}}]),e}(),J=function(){function e(t){N(this,e),this.element=t,this.name="staff-assessment",new m($("#include_staff_assessment",this.element),[$("#staff_assessment_description",this.element)],[$("#staff_assessment_description",this.element)],new F([new L])).install()}return U(e,[{key:"description",value:function(){return{required:this.isEnabled()}}},{key:"isEnabled",value:function(e){var t=$("#include_staff_assessment",this.element);return c(t,e)}},{key:"toggleEnabled",value:function(){$("#include_staff_assessment",this.element).click()}},{key:"getID",value:function(){return $(this.element).attr("id")}},{key:"validate",value:function(){return!0}},{key:"validationErrors",value:function(){return[]}},{key:"clearValidationErrors",value:function(){}}]),e}();function Y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var K=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var s=this;function a(e){var t=$("#openassessment_teamset_selection_wrapper",s.element),n=s.assessmentViews.oa_self_assessment_editor,i=s.assessmentViews.oa_peer_assessment_editor,a=s.assessmentViews.oa_student_training_editor,r=s.assessmentViews.oa_staff_assessment_editor;e&&"0"!==e?(s.setHidden(t,!1),s.setHidden($(n.element),!0),s.setHidden($(i.element),!0),s.setHidden($(a.element),!0),s.setHidden($("#self_assessment_schedule_editor",n.scheduleElement),!0),s.setHidden($("#peer_assessment_schedule_editor",i.scheduleElement),!0),s.setHidden($("#openassessment_leaderboard_wrapper .disabled-label"),!1),s.setHidden($("#openassessment_leaderboard_wrapper .teams-warning"),!1),$("#openassessment_leaderboard_editor").prop("disabled",!0),r.isEnabled(!0)):(s.setHidden(t,!0),s.setHidden($(n.element),!1),s.setHidden($(i.element),!1),s.setHidden($(a.element),!1),n.isEnabled()&&s.setHidden($("#self_assessment_schedule_editor",n.scheduleElement),!1),i.isEnabled()&&s.setHidden($("#peer_assessment_schedule_editor",i.scheduleElement),!1),s.setHidden($("#openassessment_leaderboard_wrapper .disabled-label"),!0),s.setHidden($("#openassessment_leaderboard_wrapper .teams-warning"),!0),$("#openassessment_leaderboard_editor").prop("disabled",!1))}this.settingsElement=t,this.assessmentViews=n,new p($("#openassessment_submission_file_upload_response",this.element),(function(e){var t=$("#openassessment_submission_file_upload_type_wrapper",s.element);e?t.removeClass("is--hidden"):t.addClass("is--hidden")}),new F([new L])).install(),new p($("#openassessment_submission_upload_selector",this.element),{custom:$("#openassessment_submission_white_listed_file_types_wrapper",this.element)},new F([new L])).install(),this.teamsEnabledSelectControl=new p($("#openassessment_team_enabled_selector",this.element),a,new F([new L])).install(),this.leaderboardIntField=new h($("#openassessment_leaderboard_editor",this.element),{min:0,max:100}),this.fileTypeWhiteListInputField=new v($("#openassessment_submission_white_listed_file_types",this.element),(function(e){var t=[],n=[];if(!e)return n.push(gettext("File types can not be empty.")),n;var s=$.map(e.replace(/\./g,"").toLowerCase().split(","),$.trim);return $.each(s,(function(e,n){-1!==i.FILE_EXT_BLACK_LIST.indexOf(n)&&t.push(n)})),t.length&&n.push(gettext("The following file types are not allowed: ")+t.join(",")),n})),a($("#openassessment_team_enabled_selector").val())}var t,n,i;return t=e,(n=[{key:"displayName",value:function(e){var t=$("#openassessment_title_editor",this.settingsElement);return d(t,e)}},{key:"textResponseNecessity",value:function(e){var t=$("#openassessment_submission_text_response",this.settingsElement);return void 0!==e&&t.val(e),t.val()}},{key:"fileUploadResponseNecessity",value:function(e,t){var n=$("#openassessment_submission_file_upload_response",this.settingsElement);return void 0!==e&&(t=t||!1,n.val(e),t&&$(n).trigger("change")),n.val()}},{key:"fileUploadType",value:function(e){var t=$("#openassessment_submission_file_upload_type_wrapper",this.settingsElement);if(!$(t).hasClass("is--hidden")){var n=$("#openassessment_submission_upload_selector",this.settingsElement);return void 0!==e&&n.val(e),n.val()}return""}},{key:"fileTypeWhiteList",value:function(e){return void 0!==e&&this.fileTypeWhiteListInputField.set(e),this.fileTypeWhiteListInputField.get()}},{key:"settingSelectorEnabled",value:function(e,t){var n=$(e,this.settingsElement);return void 0!==t&&(t?n.val(1):n.val(0)),"1"===n.val()}},{key:"latexEnabled",value:function(e){return this.settingSelectorEnabled("#openassessment_submission_latex_editor",e)}},{key:"teamsEnabled",value:function(e){return void 0!==e&&this.teamsEnabledSelectControl.change(e?"1":"0"),this.settingSelectorEnabled("#openassessment_team_enabled_selector",e)}},{key:"isHidden",value:function(e){return e.hasClass("is--hidden")&&"true"===e.attr("aria-hidden")}},{key:"setHidden",value:function(e,t){e.toggleClass("is--hidden",t),e.attr("aria-hidden",t?"true":"false")}},{key:"teamset",value:function(e){if(this.teamsEnabled()){var t=$("#openassessment_teamset_selector",this.settingsElement);return void 0!==e&&t.val(e),t.val()}return""}},{key:"leaderboardNum",value:function(e){return void 0!==e&&this.leaderboardIntField.set(e),this.leaderboardIntField.get(e)}},{key:"validate",value:function(){var e=!0;return e=this.leaderboardIntField.validate()&&e,"custom"===this.fileUploadType()?e=this.fileTypeWhiteListInputField.validate()&&e:this.fileTypeWhiteListInputField.get()&&!this.fileTypeWhiteListInputField.validate()&&this.fileTypeWhiteListInputField.set(""),e}},{key:"validationErrors",value:function(){var e=[];return this.leaderboardIntField.validationErrors().length>0&&e.push("Leaderboard number is invalid"),this.fileTypeWhiteListInputField.validationErrors().length>0&&(e=e.concat(this.fileTypeWhiteListInputField.validationErrors())),e}},{key:"clearValidationErrors",value:function(){this.leaderboardIntField.clearValidationErrors(),this.fileTypeWhiteListInputField.clearValidationErrors()}}])&&Y(t.prototype,n),i&&Y(t,i),e}();function q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var z="application/json; charset=utf-8",Q=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.runtime=t,this.element=n}var t,n,i;return t=e,(n=[{key:"url",value:function(e){return this.runtime.handlerUrl(this.element,e)}},{key:"render",value:function(e){var t=this,n=this.url("render_"+e);return $.Deferred((function(e){$.ajax({url:n,type:"POST",dataType:"html"}).done((function(n){e.resolveWith(t,[n])})).fail((function(){e.rejectWith(t,[gettext("This section could not be loaded.")])}))})).promise()}},{key:"renderLatex",value:function(e){e.filter(".allow--latex").each((function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub,this])}))}},{key:"renderContinuedPeer",value:function(){var e=this,t=this.url("render_peer_assessment");return $.Deferred((function(n){$.ajax({url:t,type:"POST",dataType:"html",data:{continue_grading:!0}}).done((function(t){n.resolveWith(e,[t])})).fail((function(){n.rejectWith(e,[gettext("This section could not be loaded.")])}))})).promise()}},{key:"studentInfo",value:function(e,t){var n=this.url("render_student_info");return $.Deferred((function(i){$.ajax({url:n,type:"POST",dataType:"html",data:_.extend({student_username:e},t)}).done((function(e){i.resolveWith(this,[e])})).fail((function(){i.rejectWith(this,[gettext("This section could not be loaded.")])}))})).promise()}},{key:"staffGradeForm",value:function(){var e=this.url("render_staff_grade_form");return $.Deferred((function(t){$.ajax({url:e,type:"POST",dataType:"html"}).done((function(e){t.resolveWith(this,[e])})).fail((function(){t.rejectWith(this,[gettext("The staff assessment form could not be loaded.")])}))})).promise()}},{key:"staffGradeCounts",value:function(){var e=this.url("render_staff_grade_counts");return $.Deferred((function(t){$.ajax({url:e,type:"POST",dataType:"html"}).done((function(e){t.resolveWith(this,[e])})).fail((function(){t.rejectWith(this,[gettext("The display of ungraded and checked out responses could not be loaded.")])}))})).promise()}},{key:"submit",value:function(e){var t=this.url("submit");return $.Deferred((function(n){$.ajax({type:"POST",url:t,data:JSON.stringify({submission:e}),contentType:z}).done((function(e){if(e[0]){var t=e[1],i=e[2];n.resolveWith(this,[t,i])}else{var s=e[1],a=e[2];n.rejectWith(this,[s,a])}})).fail((function(){n.rejectWith(this,["AJAX",gettext("This response could not be submitted.")])}))})).promise()}},{key:"save",value:function(e){var t=this.url("save_submission");return $.Deferred((function(n){$.ajax({type:"POST",url:t,data:JSON.stringify({submission:e}),contentType:z}).done((function(e){e.success?n.resolve():n.rejectWith(this,[e.msg])})).fail((function(){n.rejectWith(this,[gettext("This response could not be saved.")])}))})).promise()}},{key:"submitFeedbackOnAssessment",value:function(e,t){var n=this.url("submit_feedback"),i=JSON.stringify({feedback_text:e,feedback_options:t});return $.Deferred((function(e){$.ajax({type:"POST",url:n,data:i,contentType:z}).done((function(t){t.success?e.resolve():e.rejectWith(this,[t.msg])})).fail((function(){e.rejectWith(this,[gettext("This feedback could not be submitted.")])}))})).promise()}},{key:"submitAssessment",value:function(e,t){var n=this.url(e);return $.Deferred((function(e){$.ajax({type:"POST",url:n,data:JSON.stringify(t),contentType:z}).done((function(t){t.success?e.resolve():e.rejectWith(this,[t.msg])})).fail((function(){e.rejectWith(this,[gettext("This assessment could not be submitted.")])}))})).promise()}},{key:"peerAssess",value:function(e,t,n,i){return this.submitAssessment("peer_assess",{options_selected:e,criterion_feedback:t,overall_feedback:n,submission_uuid:i})}},{key:"selfAssess",value:function(e,t,n){return this.submitAssessment("self_assess",{options_selected:e,criterion_feedback:t,overall_feedback:n})}},{key:"staffAssess",value:function(e,t,n,i,s){return this.submitAssessment("staff_assess",{options_selected:e,criterion_feedback:t,overall_feedback:n,submission_uuid:i,assess_type:s})}},{key:"trainingAssess",value:function(e){var t=this.url("training_assess"),n=JSON.stringify({options_selected:e});return $.Deferred((function(e){$.ajax({type:"POST",url:t,data:n,contentType:z}).done((function(t){t.success?e.resolveWith(this,[t.corrections]):e.rejectWith(this,[t.msg])})).fail((function(){e.rejectWith(this,[gettext("This assessment could not be submitted.")])}))}))}},{key:"scheduleTraining",value:function(){var e=this.url("schedule_training");return $.Deferred((function(t){$.ajax({type:"POST",url:e,data:'""',contentType:z}).done((function(e){e.success?t.resolveWith(this,[e.msg]):t.rejectWith(this,[e.msg])})).fail((function(){t.rejectWith(this,[gettext("This assessment could not be submitted.")])}))}))}},{key:"rescheduleUnfinishedTasks",value:function(){var e=this.url("reschedule_unfinished_tasks");return $.Deferred((function(t){$.ajax({type:"POST",url:e,data:'""',contentType:z}).done((function(e){e.success?t.resolveWith(this,[e.msg]):t.rejectWith(this,[e.msg])})).fail((function(){t.rejectWith(this,[gettext("One or more rescheduling tasks failed.")])}))}))}},{key:"updateEditorContext",value:function(e){var t=this.url("update_editor_context"),n=JSON.stringify({prompts:e.prompts,prompts_type:e.prompts_type,feedback_prompt:e.feedbackPrompt,feedback_default_text:e.feedback_default_text,title:e.title,submission_start:e.submissionStart,submission_due:e.submissionDue,criteria:e.criteria,assessments:e.assessments,editor_assessments_order:e.editorAssessmentsOrder,text_response:e.textResponse,file_upload_response:e.fileUploadResponse,file_upload_type:e.fileUploadType,white_listed_file_types:e.fileTypeWhiteList,allow_latex:e.latexEnabled,leaderboard_show:e.leaderboardNum,teams_enabled:e.teamsEnabled,selected_teamset_id:e.selectedTeamsetId});return $.Deferred((function(e){$.ajax({type:"POST",url:t,data:n,contentType:z}).done((function(t){t.success?e.resolve():e.rejectWith(this,[t.msg])})).fail((function(){e.rejectWith(this,[gettext("This problem could not be saved.")])}))})).promise()}},{key:"checkReleased",value:function(){var e=this.url("check_released");return $.Deferred((function(t){$.ajax({type:"POST",url:e,data:'""',contentType:z}).done((function(e){e.success?t.resolveWith(this,[e.is_released]):t.rejectWith(this,[e.msg])})).fail((function(){t.rejectWith(this,[gettext("The server could not be contacted.")])}))})).promise()}},{key:"getUploadUrl",value:function(e,t,n){var i=this.url("upload_url");return $.Deferred((function(s){$.ajax({type:"POST",url:i,data:JSON.stringify({contentType:e,filename:t,filenum:n}),contentType:z}).done((function(e){e.success?s.resolve(e.url):s.rejectWith(this,[e.msg])})).fail((function(){s.rejectWith(this,[gettext("Could not retrieve upload url.")])}))})).promise()}},{key:"removeUploadedFile",value:function(e){var t=this.url("remove_uploaded_file");return $.Deferred((function(n){$.ajax({type:"POST",url:t,data:JSON.stringify({filenum:e}),contentType:z}).done((function(e){e.success?n.resolve():n.rejectWith(this,[e.msg])})).fail((function(){n.rejectWith(this,[gettext("Server error.")])}))})).promise()}},{key:"saveFilesDescriptions",value:function(e){var t=this.url("save_files_descriptions");return $.Deferred((function(n){$.ajax({type:"POST",url:t,data:JSON.stringify({fileMetadata:e}),contentType:z}).done((function(e){e.success?n.resolve():n.rejectWith(this,[e.msg])})).fail((function(){n.rejectWith(this,[gettext("Server error.")])}))})).promise()}},{key:"getDownloadUrl",value:function(e){var t=this.url("download_url");return $.Deferred((function(n){$.ajax({type:"POST",url:t,data:JSON.stringify({filenum:e}),contentType:z}).done((function(e){e.success?n.resolve(e.url):n.rejectWith(this,[e.msg])})).fail((function(){n.rejectWith(this,[gettext("Could not retrieve download url.")])}))})).promise()}},{key:"cancelSubmission",value:function(e,t){var n=this.url("cancel_submission"),i=JSON.stringify({submission_uuid:e,comments:t});return $.Deferred((function(e){$.ajax({type:"POST",url:n,data:i,contentType:z}).done((function(t){t.success&&e.resolveWith(this,[t.msg])})).fail((function(){e.rejectWith(this,[gettext("The submission could not be removed from the grading pool.")])}))})).promise()}},{key:"publishEvent",value:function(e,t){t.event_name=e;var n=this.url("publish_event"),i=JSON.stringify(t);$.ajax({type:"POST",url:n,data:i,contentType:z})}},{key:"getTeamDetail",value:function(e){var t=window.location.origin+"/api/team/v0/teams/"+e;return $.ajax({type:"GET",url:t,contentType:z})}},{key:"listTeam",value:function(e,t){var n=window.location.origin+"/api/team/v0/teams/";return $.Deferred((function(i){$.ajax({type:"GET",url:n,data:{course_id:t,username:e},contentType:z}).done((function(e){e.count>1?i.rejectWith(this,[gettext("Multiple teams returned for course")]):0===e.count?i.resolveWith(this,[null]):i.resolveWith(this,[e.results[0]])})).fail((function(){i.rejectWith(this,[gettext("Could not load teams information.")])}))})).promise()}},{key:"getUsername",value:function(){var e=this.url("get_student_username");return $.Deferred((function(t){$.ajax({type:"POST",url:e,data:JSON.stringify({}),contentType:z}).done((function(e){null===e.username?t.rejectWith(this,[gettext("User lookup failed")]):t.resolveWith(this,[e.username])})).fail((function(){t.rejectWith(this,[gettext("Error when looking up username")])}))}))}}])&&q(t.prototype,n),i&&q(t,i),e}();function X(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Z=function(){function e(t,n,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=n,this.runtime=t,this.server=i,this.data=a,this.fixModalHeight(),this.initializeTabs(),this.alert=(new s).install();var r=new StudentTrainingListener;this.promptsView=new O($("#oa_prompts_editor_wrapper",this.element).get(0),new F([r])),this.rubricView=new I($("#oa_rubric_editor_wrapper",this.element).get(0),new F([r])),this.scheduleView=new P($("#oa_schedule_editor_wrapper",this.element).get(0));var o=new J($("#oa_staff_assessment_editor",this.element).get(0)),l=new G($("#oa_student_training_editor",this.element).get(0)),u=new M($("#oa_peer_assessment_editor",this.element).get(0),$("#oa_schedule_editor_wrapper",this.element).get(0)),d=new EditSelfAssessmentView($("#oa_self_assessment_editor",this.element).get(0),$("#oa_schedule_editor_wrapper",this.element).get(0)),c={};c[o.getID()]=o,c[l.getID()]=l,c[u.getID()]=u,c[d.getID()]=d,this.assessmentsStepsView=new EditAssessmentsStepsView($("#oa_assessment_steps_editor_wrapper",this.element).get(0),c),this.settingsView=new K($("#oa_basic_settings_editor",this.element).get(0),c,a),$(".openassessment_save_button",this.element).click($.proxy(this.save,this)),$(".openassessment_cancel_button",this.element).click($.proxy(this.cancel,this))}var t,n,i;return t=e,(n=[{key:"fixModalHeight",value:function(){$(this.element).addClass("openassessment_full_height").parentsUntil(".modal-window").addClass("openassessment_full_height"),$(this.element).closest(".modal-window").addClass("openassessment_modal_window")}},{key:"initializeTabs",value:function(){void 0===this.lastOpenEditingTab&&(this.lastOpenEditingTab=0),$(".openassessment_editor_content_and_tabs",this.element).tabs({active:this.lastOpenEditingTab})}},{key:"saveTabState",value:function(){var e=$(".openassessment_editor_content_and_tabs",this.element);this.lastOpenEditingTab=e.tabs("option","active")}},{key:"save",value:function(){var e=this;this.saveTabState(),this.clearValidationErrors(),this.validate()?(this.alert.hide(),this.server.checkReleased().done((function(t){t?e.confirmPostReleaseUpdate($.proxy(e.updateEditorContext,e)):e.updateEditorContext()})).fail((function(t){e.showError(t)}))):this.alert.setMessage(gettext("Couldn't Save This Assignment"),gettext("Please correct the outlined fields.")).show()}},{key:"confirmPostReleaseUpdate",value:function(e){var t=gettext("This problem has already been released. Any changes will apply only to future assessments.");confirm(t)&&e()}},{key:"updateEditorContext",value:function(){this.runtime.notify("save",{state:"start"});var e=this,t=e.settingsView.fileUploadType();this.server.updateEditorContext({prompts:e.promptsView.promptsDefinition(),prompts_type:e.promptsView.promptsType(),feedbackPrompt:e.rubricView.feedbackPrompt(),feedback_default_text:e.rubricView.feedback_default_text(),criteria:e.rubricView.criteriaDefinition(),title:e.settingsView.displayName(),submissionStart:e.scheduleView.submissionStart(),submissionDue:e.scheduleView.submissionDue(),assessments:e.assessmentsStepsView.assessmentsDescription(),textResponse:e.settingsView.textResponseNecessity(),fileUploadResponse:e.settingsView.fileUploadResponseNecessity(),fileUploadType:""!==t?t:null,fileTypeWhiteList:e.settingsView.fileTypeWhiteList(),latexEnabled:e.settingsView.latexEnabled(),leaderboardNum:e.settingsView.leaderboardNum(),editorAssessmentsOrder:e.assessmentsStepsView.editorAssessmentsOrder(),teamsEnabled:e.settingsView.teamsEnabled(),selectedTeamsetId:e.settingsView.teamset()}).done((function(){e.runtime.notify("save",{state:"end"})})).fail((function(t){e.showError(t)}))}},{key:"cancel",value:function(){this.saveTabState(),this.runtime.notify("cancel",{})}},{key:"showError",value:function(e){this.runtime.notify("error",{msg:e})}},{key:"validate",value:function(){var e=this.settingsView.validate(),t=this.assessmentsStepsView.validate(),n=this.scheduleView.validate(),i=this.rubricView.validate(),s=this.promptsView.validate();return e&&t&&n&&i&&s}},{key:"validationErrors",value:function(){return this.settingsView.validationErrors().concat(this.assessmentsStepsView.validationErrors().concat(this.scheduleView.validationErrors().concat(this.rubricView.validationErrors().concat(this.promptsView.validationErrors()))))}},{key:"clearValidationErrors",value:function(){this.settingsView.clearValidationErrors(),this.assessmentsStepsView.clearValidationErrors(),this.scheduleView.clearValidationErrors(),this.rubricView.clearValidationErrors(),this.promptsView.clearValidationErrors()}}])&&X(t.prototype,n),i&&X(t,i),e}();window.OpenAssessmentEditor=function(e,t,n){var i=new Q(e,t);new Z(e,t,i,n)}}]);
//# sourceMappingURL=studio.js.map